(this["webpackJsonppathfinder-react"]=this["webpackJsonppathfinder-react"]||[]).push([[0],{416:function(t,e,n){},431:function(t,e){},432:function(t,e){},440:function(t,e){},443:function(t,e){},444:function(t,e){},460:function(t,e,n){"use strict";n.r(e);var r,i=n(2),a=n.n(i),o=n(35),s=n(62),c=n.n(s),l=(n(416),n(3)),u=n(511),h=n(513),x=n(37),y=n(38),d=y.b.div(r||(r=Object(x.a)(["\n  width: 30px;\n  height: 20px;\n  position: fixed;\n  top: 15px;\n  left: 25px;\n  z-index: 1201;\n  cursor: pointer;\n\n  span {\n    display: block;\n    position: absolute;\n    height: 4px;\n    width: 100%;\n    background: black;\n    border-radius: 3px;\n    opacity: 1;\n    left: 0;\n    -webkit-transform: rotate(0deg);\n    -moz-transform: rotate(0deg);\n    -o-transform: rotate(0deg);\n    transform: rotate(0deg);\n    -webkit-transition: 0.25s ease-in-out;\n    -moz-transition: 0.25s ease-in-out;\n    -o-transition: 0.25s ease-in-out;\n    transition: 0.25s ease-in-out;\n  }\n\n  span:nth-child(1) {\n    top: ",";\n    -webkit-transform: ",";\n    -moz-transform: ",";\n    -o-transform: ",";\n    transform: ",";\n  }\n\n  span:nth-child(2) {\n    top: 8px;\n    opacity: ",";\n    left: ",";\n  }\n\n  span:nth-child(3) {\n    top: ",";\n    -webkit-transform: ",";\n    -moz-transform: ",";\n    -o-transform: ",";\n    transform: ",";\n  }\n"])),(function(t){return t.open?"8px":"0px"}),(function(t){return t.open?"rotate(135deg)":"initial"}),(function(t){return t.open?"rotate(135deg)":"initial"}),(function(t){return t.open?"rotate(135deg)":"initial"}),(function(t){return t.open?"rotate(135deg)":"initial"}),(function(t){return t.open?"0":"initial"}),(function(t){return t.open?"-60px":"0"}),(function(t){return t.open?"8px":"16px"}),(function(t){return t.open?"rotate(-135deg)":"initial"}),(function(t){return t.open?"rotate(-135deg)":"initial"}),(function(t){return t.open?"rotate(-135deg)":"initial"}),(function(t){return t.open?"rotate(-135deg)":"initial"})),b=n(4);function g(t){var e=t.setMenuOpen,n=t.menuOpen;return Object(b.jsx)(h.a,{title:n?"":"Open Menu",children:Object(b.jsxs)(d,{open:n,onClick:function(){e(!n)},children:[Object(b.jsx)("span",{}),Object(b.jsx)("span",{}),Object(b.jsx)("span",{})]})})}var f,j,p,z,m=n(26),O=n(498),v=n(501),w=n(502),k=n(346),S=n.n(k),P=y.b.div(f||(f=Object(x.a)(['\n  height: 100vh;\n  width: 100vw;\n  overflow-x: hidden;\n  font-size: 1rem;\n  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,\n    Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;\n']))),T=y.b.div(j||(j=Object(x.a)(["\n  cursor: pointer;\n  position: absolute;\n  top: 5px;\n  left: 25px;\n  z-index: 2;\n"]))),C=n(90),R={trafficLights:!1,cameraLock:void 0,collisionBoxes:!1,computerNumber:60,trafficConditions:!1,time:"sunset",obstacles:[],addObstacles:!1,AICar:!1,helpOpen:!1},M=Object(C.b)({name:"settings",initialState:R,reducers:{toggleTrafficLights:function(t){t.trafficLights=!t.trafficLights},toggleCameraLock:function(t){t.cameraLock=!t.cameraLock},enableCameraLock:function(t){t.cameraLock=!0},toggleCollisionBoxes:function(t){t.collisionBoxes=!t.collisionBoxes},toggleTrafficConditions:function(t){t.trafficConditions=!t.trafficConditions},changeComputerNumber:function(t,e){t.computerNumber=e.payload},toggleTime:function(t){"day"===t.time?t.time="sunset":"sunset"===t.time?t.time="night":"night"===t.time&&(t.time="day")},addObstacles:function(t,e){var n=e.payload||!t.addObstacles;t.addObstacles=n},newObstacle:function(t,e){t.obstacles.push(e.payload)},removeObstacles:function(t){t.obstacles=[]},toggleAICar:function(t){t.AICar=!t.AICar,t.addObstacles=!1,t.obstacles=[]},disableAICar:function(t){t.AICar=!1},toggleHelpOpen:function(t){t.helpOpen=!t.helpOpen}}}),I=M.actions,D=(I.toggleTrafficLights,I.toggleCameraLock),L=I.enableCameraLock,F=(I.toggleCollisionBoxes,I.toggleTrafficConditions,I.changeComputerNumber,I.toggleTime),A=I.addObstacles,V=I.newObstacle,E=I.removeObstacles,B=I.toggleAICar,_=I.disableAICar,G=I.toggleHelpOpen,N=M.reducer,W=n(345),U=n.n(W);function X(t){var e=t.onClick;return Object(b.jsx)(T,{children:Object(b.jsx)(U.a,{fontSize:"large",onClick:e})})}var q=y.b.div(p||(p=Object(x.a)(["\n  position: fixed;\n  z-index: 1;\n  width: 300px;\n  min-height: 100vh;\n  border-right: 1px solid grey;\n  padding: 50px 20px 0 0;\n  background-color: white;\n"]))),Z=y.b.div(z||(z=Object(x.a)(["\n  cursor: pointer;\n  margin: 5px 0;\n  border-radius: 0 20px 20px 0;\n  padding: 3px 10px 3px 25px;\n  font-weight: 500;\n  text-transform: capitalize;\n  background-color: ",";\n  color: ",";\n  &:hover {\n    background-color: ",";\n  }\n"])),(function(t){return t.current?"rgb(232,240,254)":"rgb(245, 245, 245)"}),(function(t){return t.current?"rgb(24,90,188)":"black"}),(function(t){return t.current?"rgb(232,240,254)":"rgb(225, 225, 225)"}));function H(t){var e=t.section,n=t.current;return Object(b.jsx)(Z,{current:n,onClick:function(){e.ref.current.scrollIntoView()},children:e.name})}var Y,J,Q,K,$=function(t){var e=Object(i.useState)(0),n=Object(l.a)(e,2),r=n[0],a=n[1];return Object(i.useEffect)((function(){var e=[];return t.forEach((function(t){var n={isVisible:!1};n.observer=new IntersectionObserver((function(t){var r=Object(l.a)(t,1)[0];n.isVisible=r.isIntersecting,function(){for(var t=0;t<e.length;t++)if(e[t].isVisible){a(t);break}}()})),n.observer.observe(t.ref.current),e.push(n)})),function(){e.forEach((function(t){t.observer.disconnect()}))}}),[t]),r};function tt(t){var e=t.sections,n=$(e);return Object(b.jsx)(q,{children:e.map((function(t,e){return Object(b.jsx)(H,{section:t,current:n===e},e)}))})}var et,nt,rt=y.b.div(Y||(Y=Object(x.a)(["\n  margin-left: 300px;\n  width: 100vw;\n  min-height: 100vh;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  position: relative;\n  z-index: 3;\n"]))),it=y.b.div(J||(J=Object(x.a)(["\n  min-width: 600px;\n  max-width: 740px;\n  min-height: calc(100vh - 64px);\n  margin: 32px 0;\n  padding: 32px 50px;\n  border: 1px solid grey;\n  border-radius: 30px;\n  display: flex;\n  flex-direction: column;\n  background-color: white;\n"]))),at=y.b.div(Q||(Q=Object(x.a)(["\n  display: flex;\n  flex-direction: column;\n  margin-top: 16px;\n"]))),ot=y.b.div(K||(K=Object(x.a)(["\n  font-size: 2rem;\n  color: rgb(24, 90, 188);\n  font-weight: 500;\n  margin: 16px 0;\n  text-transform: capitalize;\n"])));function st(t){var e=t.section,n=e.data;return Object(b.jsxs)(at,{ref:e.ref,children:[Object(b.jsx)(ot,{children:e.name}),Object(b.jsx)(n,{})]})}function ct(t){var e=t.sections;return Object(b.jsx)(rt,{children:Object(b.jsx)(it,{children:e.map((function(t,e){return Object(b.jsx)(st,{section:t},e)}))})})}var lt=y.b.div(et||(et=Object(x.a)(["\n  font-size: 1.1rem;\n  font-weight: 700;\n  margin: 12px 0;\n  color: rgb(24, 90, 188);\n"]))),ut=y.b.div(nt||(nt=Object(x.a)(["\n  padding: 4px 12px;\n  text-align: justify;\n"])));function ht(){return Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)(lt,{children:"Keyboard"}),Object(b.jsxs)(ut,{children:[Object(b.jsx)("b",{children:"W"})," - accelerate"]}),Object(b.jsxs)(ut,{children:[Object(b.jsx)("b",{children:"S"})," - reverse"]}),Object(b.jsxs)(ut,{children:[Object(b.jsx)("b",{children:"A"})," - steer left"]}),Object(b.jsxs)(ut,{children:[Object(b.jsx)("b",{children:"D"})," - steer right"]}),Object(b.jsxs)(ut,{children:[Object(b.jsx)("b",{children:"Space"})," - brake"]}),Object(b.jsxs)(ut,{children:[Object(b.jsx)("b",{children:"R"})," - reset"]}),Object(b.jsx)(lt,{children:"Mouse"}),Object(b.jsxs)(ut,{children:[Object(b.jsx)("b",{children:"Point and click"})," on any part of the road to begin self driving."]}),Object(b.jsx)(ut,{children:"By default this uses a manually programmed pathfinding and self driving algorithm."}),Object(b.jsx)(ut,{children:"A self trained neural network can also be used (see below)."}),Object(b.jsx)(lt,{children:"Camera"}),Object(b.jsx)(ut,{children:"Hold the left or right mouse button and drag the mouse."}),Object(b.jsx)(ut,{children:"Use the scroll wheel to zoom in and out."}),Object(b.jsx)(ut,{children:"Press the camera icon to follow the vehicle."}),Object(b.jsx)(ut,{})]})}var xt,yt,dt,bt,gt=n(187),ft=n.n(gt),jt=n.p+"static/media/AI evolution.40a6be49.JPG",pt=n.p+"static/media/perceptron.fee338de.png",zt=y.b.div(xt||(xt=Object(x.a)(["\n  width: ","px;\n  height: ","px;\n  margin: 20px 0;\n"])),(function(t){return t.width}),(function(t){return t.height})),mt=y.b.img(yt||(yt=Object(x.a)(["\n  cursor: ",";\n  max-width: ",";\n  height: ",";\n  position: ",";\n  top: 50%;\n  left: 50%;\n  transform: ",";\n  z-index: 1;\n"])),(function(t){return t.clicked?"zoom-out":"zoom-in"}),(function(t){return t.clicked?"90vw":"100%"}),(function(t){return t.clicked?"90vh":"100%"}),(function(t){return t.clicked?"fixed":""}),(function(t){return t.clicked?"translate(-50%, -50%);":""})),Ot=y.b.div(dt||(dt=Object(x.a)(["\n  position: fixed;\n  top: 0px;\n  left: 0px;\n  background-color: rgba(0, 0, 0, 0.7);\n  width: 100vw;\n  height: 100vh;\n  z-index: 0;\n"])));function vt(t){var e=t.src,n=t.alt,r=t.height,a=t.width,o=Object(i.useState)(!1),s=Object(l.a)(o,2),c=s[0],u=s[1];return Object(b.jsxs)(zt,{height:r,width:a,children:[Object(b.jsx)(mt,{onClick:function(){return u(!c)},clicked:c,src:e,alt:n}),c&&Object(b.jsx)(Ot,{})]})}function wt(){return Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)(ft.a,{url:"https://youtu.be/NwyDRwl1pO4",controls:!0}),Object(b.jsx)(lt,{children:"Architecture"}),Object(b.jsx)(vt,{height:400,width:640,src:pt,alt:"training"}),Object(b.jsx)(ut,{children:"This was my first go at using neural networks, so I kept things pretty simple. I made a multilayer perceptron using Tensorflow.js and used neuroevolution to train the network."}),Object(b.jsxs)(ut,{children:["I initially tried using the"," ",Object(b.jsx)("a",{href:"https://en.wikipedia.org/wiki/Neuroevolution_of_augmenting_topologies",target:"_blank",rel:"noreferrer",children:"NEAT"})," ","algorithm, but it never managed to get passed the first turn (probably a failing of my simulation/fitness function)."]}),Object(b.jsxs)(ut,{children:[Object(b.jsx)("b",{children:"Inputs:"})," Velocity, heading variance (difference between current heading and desired heading), distance to the next turn, distance to the destination."]}),Object(b.jsxs)(ut,{children:[Object(b.jsx)("b",{children:"Outputs:"})," Steering force, acceleration, braking."]}),Object(b.jsx)(lt,{children:"Training"}),Object(b.jsx)(vt,{height:400,width:640,src:jt,alt:"training"}),Object(b.jsxs)(ut,{children:["I used a"," ",Object(b.jsx)("a",{href:"https://towardsdatascience.com/introduction-to-genetic-algorithms-including-example-code-e396e98d8bf3",target:"_blank",rel:"noreferrer",children:"genetic algorithm"})," ","to evolve the network. It probably would have been a lot faster to use the inputs and outputs from my manual self driving algorithm and use"," ",Object(b.jsx)("a",{href:"https://en.wikipedia.org/wiki/Stochastic_gradient_descent",target:"_blank",rel:"noreferrer",children:"SGD"})," ","to optimize the network, but I wanted to see if the AI to train itself without any human input. There was definitely a lot of trial and error e.g. tweaking the fitness function, mutation rate, population size, and network size, but I'm really happy with how it worked out."]}),Object(b.jsx)(ut,{children:"You can see on the graph where the main challenges were. It took about 25 generations before it figured out how to turn. It didn't figure out how to brake at the end until generation 55, and then it continued tweaking itself, gradually getting faster and faster."}),Object(b.jsx)(ut,{children:"For the fitness function, I used a combination of the distance travelled, proximity of it's final position to the end point (to make sure it braked properly), and time taken."}),Object(b.jsx)(ut,{children:"The fitness determined the chance of the network moving onto the next generation and a small mutation rate was used to tweak the weights and biases."}),Object(b.jsx)(lt,{children:"Observations"}),Object(b.jsx)(ut,{children:'The AI clearly suffers from "overfitting" to the specific training route. The route included 4 right turns (including a hairpin) and only 1 left turn, so the AI learned to stick to the left side of the road, always ready to make a right turn.'}),Object(b.jsx)(ut,{children:"There's also zero tolerance to any latency. The physics engine is asynchronous, so there's a chance the AI will mess up a turn on a slow computer."}),Object(b.jsx)(lt,{children:"Future plans"}),Object(b.jsx)(ut,{children:"It's probably a good idea to randomise the training path, to avoid overfitting issues. Hopefully it would also get better at driving in a straight line."}),Object(b.jsx)(ut,{children:"I also want to try including the obstacle detection inputs to see if it can learn to avoid random obstacles."})]})}function kt(){return Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)(ft.a,{url:"https://youtu.be/7vgvm4FwbMk",controls:!0}),Object(b.jsx)(ut,{children:"This mode demonstrates the genetic algorithm used for the training the neural network. Just to be clear, this isn't actually training a neural network (that took a few thousand simulated hours)."}),Object(b.jsx)(ut,{children:"Instead, I'm evolving the parameters for my manual self driving algorithm e.g. steering force, acceleration, braking, vision distance."}),Object(b.jsx)(ut,{children:"Each attempt is completely random, but the cars should evolve to a decent level within about 10 generations."}),Object(b.jsx)(lt,{children:"Instructions"}),Object(b.jsxs)(ut,{children:[Object(b.jsx)("b",{children:"Load next generation: "}),'The training simulations are done asynchronously on a separate thread, and the loading bar gives an indication of it\'s progress. When ready, press the "Next generation" button to load the next generation of vehicles.']}),Object(b.jsxs)(ut,{children:[Object(b.jsx)("b",{children:"Mutation rate: "}),"By default, the mutation rate is 1% which works pretty well. If the scores are no longer increasing, try increasing the mutation rate to add some variation to the population."]}),Object(b.jsxs)(ut,{children:[Object(b.jsx)("b",{children:"Population size: "}),"The higher the population size, the better the results will be, but the simulations will take much longer. Try adjusting the size depending on your computer speed."]}),Object(b.jsxs)(ut,{children:[Object(b.jsx)("b",{children:"Restart: "}),"Start again from scratch."]}),Object(b.jsxs)(ut,{children:[Object(b.jsx)("b",{children:"Pretrained settings: "}),"Load the default parameters."]}),Object(b.jsxs)(ut,{children:[Object(b.jsx)("b",{children:"Scoring: "}),"This is based on the distance travelled and time taken. 100% is the score I got for my default parameters. It's possible to get higher than 100%, but the braking and steering will get more aggressive."]}),Object(b.jsxs)(ut,{children:[Object(b.jsx)("b",{children:"Ghosts: "}),'The best car from each population will be shown as the main car. Additional random cars from the population can be shown using the "ghosts" slider. Just a note, it\'s possible (but quite rare) that the cars will collide with each other. This is just a glitch in the physics engine.']})]})}function St(){return Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)(ft.a,{url:"https://youtu.be/0tmCX2IiV_Q",controls:!0}),Object(b.jsx)(lt,{children:"Instructions"}),Object(b.jsxs)(ut,{children:[Object(b.jsx)("b",{children:"Add obstacles:"}),' Select the "Add obstacles" button and click on the road to add an obstacle. Remember to deselect the button when finished.']}),Object(b.jsxs)(ut,{children:[Object(b.jsx)("b",{children:"Remove obstacles:"}),' Select the "Remove obstacles" button to remove all obstacles.']}),Object(b.jsx)(ut,{children:"All obstacles will be removed when training or using the neural network."})]})}var Pt=y.b.div(bt||(bt=Object(x.a)(["\n  max-width: 100vw;\n  position: relative;\n  display: flex;\n"])));function Tt(){var t=function(){var t=Object(i.useRef)(),e=Object(i.useRef)();return[{name:"Controls",ref:t,data:ht},{name:"Neural Network",ref:Object(i.useRef)(),data:wt},{name:"Training",ref:Object(i.useRef)(),data:kt},{name:"Obstacles",ref:e,data:St}]}();return Object(b.jsxs)(Pt,{children:[Object(b.jsx)(tt,{sections:t}),Object(b.jsx)(ct,{sections:t})]})}var Ct=a.a.forwardRef((function(t,e){return Object(b.jsx)(O.a,Object(m.a)({ref:e},t))}));function Rt(){var t=Object(o.b)(),e=Object(o.c)((function(t){return t.settings.helpOpen})),n=function(){t(G())};return Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)(v.a,{onClick:n,children:Object(b.jsx)(S.a,{fontSize:"large"})}),Object(b.jsx)(w.a,{maxWidth:!1,open:e,onClose:n,TransitionComponent:Ct,children:Object(b.jsxs)(P,{children:[Object(b.jsx)(X,{onClick:n}),Object(b.jsx)(Tt,{})]})})]})}var Mt,It,Dt=n(347),Lt=n.n(Dt),Ft=n(503),At=Object(y.b)(Ft.a)(Mt||(Mt=Object(x.a)(["\n  color: black;\n  box-shadow: ",";\n  position: absolute;\n  left: 10px;\n"])),(function(t){return t.enabled?"inset -4px -4px 8px rgba(255, 255, 255, 0.6), inset 8px 8px 16px rgba(0, 0, 0, 0.2)":"-6px -6px 10px rgba(255, 255, 255, 0.7), 6px 6px 10px rgba(0, 0, 0, 0.3)"})),Vt=Object(y.b)(Ft.a)(It||(It=Object(x.a)(["\n  margin: 0 10px;\n  color: black;\n  height: 45px;\n  width: 45px;\n  box-shadow: ",";\n"])),(function(t){return t.enabled?"inset -4px -4px 8px rgba(255, 255, 255, 0.6), inset 8px 8px 16px rgba(0, 0, 0, 0.2)":"-6px -6px 10px rgba(255, 255, 255, 0.7), 6px 6px 10px rgba(0, 0, 0, 0.3)"}));function Et(){var t=Object(o.b)(),e=Object(o.c)((function(t){return t.settings.cameraLock}));return Object(b.jsx)(h.a,{title:"Toggle camera lock",children:Object(b.jsx)(Vt,{enabled:e?1:0,onClick:function(){t(D())},children:Object(b.jsx)(Lt.a,{})})})}var Bt,_t,Gt,Nt,Wt,Ut,Xt=n(8),qt=n.n(Xt),Zt=n(17),Ht=Object(C.b)({name:"mode",initialState:{mode:"mouse",stats:!1},reducers:{mouseMode:function(t){t.mode="mouse"},keyboardMode:function(t){t.mode="keyboard"}}}),Yt=Ht.actions,Jt=Yt.mouseMode,Qt=Yt.keyboardMode,Kt=Ht.reducer,$t={steerVal:.875,maxForce:1e3,maxBrakeForce:20,maxSpeed:18,stoppingDistance:35,slowDistance:20},te=Object(C.b)({name:"training",initialState:{currentDNA:null,training:!1,ghosts:[]},reducers:{setCurrentDNA:function(t,e){var n=e.payload||$t;t.currentDNA=n},toggleTraining:function(t){t.training=!t.training},updateGhosts:function(t,e){t.ghosts=e.payload}}}),ee=te.actions,ne=ee.setCurrentDNA,re=ee.toggleTraining,ie=ee.updateGhosts,ae=te.reducer,oe=y.b.div(Bt||(Bt=Object(x.a)(['\n  width: 400px;\n  padding: 60px 25px 0 25px;\n  background-color: transparent;\n  display: flex;\n  flex-direction: column;\n  align-items: flex-start;\n  font-size: 1.1rem;\n  font-weight: 600;\n  color: darkslategray;\n  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,\n    Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;\n']))),se=y.b.div(_t||(_t=Object(x.a)(["\n  display: flex;\n  position: absolute;\n  top: 0;\n  right: 0;\n  width: 100%;\n  align-items: flex-end;\n  justify-content: flex-end;\n  padding: 5px;\n"]))),ce=y.b.div(Gt||(Gt=Object(x.a)(["\n  position: relative;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  margin: 5px 0;\n  padding: 10px;\n  width: 100%;\n  border-radius: 10px;\n  box-shadow: 0 0 10px -1px slategray;\n  height: 70px;\n"]))),le=y.b.div(Nt||(Nt=Object(x.a)(["\n  width: 100%;\n  display: flex;\n  justify-content: space-between;\n"]))),ue=y.b.div(Wt||(Wt=Object(x.a)(["\n  height: 10px;\n  width: ","%;\n  align-self: flex-start;\n  background: rgb(9, 90, 121);\n  background: linear-gradient(\n    90deg,\n    rgba(9, 90, 121, 1) 35%,\n    rgba(0, 189, 255, 1) 100%\n  );\n  border-radius: 5px;\n  transition: ","s ease-in-out;\n"])),(function(t){return t.progress}),(function(t){return t.progress?"0.5":"0"})),he=y.b.div(Ut||(Ut=Object(x.a)(["\n  display: flex;\n  flex-direction: column;\n  justify-content: space-around;\n  align-items: center;\n  width: 100%;\n  height: 100%;\n"])));function xe(t){var e=t.generation,n=t.score,r=t.avgScore;return Object(b.jsxs)(ce,{children:[Object(b.jsxs)("div",{children:["Generation ",e]}),Object(b.jsxs)(le,{children:[Object(b.jsxs)("div",{children:["Best Score: ",n,"%"]}),Object(b.jsxs)("div",{children:["Average Score: ",r,"%"]})]})]})}function ye(t){var e=t.progress;return Object(b.jsx)(ce,{children:Object(b.jsxs)(he,{children:[e<100?"Training in progress":"Training complete",Object(b.jsx)(ue,{progress:e})]})})}var de=n(348),be=n.n(de);function ge(t){var e=t.disabled,n=t.onClick;return Object(b.jsxs)(ce,{children:[Object(b.jsx)(At,{disabled:e,onClick:n,children:Object(b.jsx)(be.a,{fontSize:"large"})}),"Next generation"]})}var fe=n(56),je=n(514),pe=Object(fe.a)({root:{color:"rgb(5,132,178)"},thumb:{color:"lightgrey",height:"20px",width:"20px",marginLeft:"-10px","&:hover":{boxShadow:"0px 0px 0px 8px rgba(28, 132, 255, 0.16)","@media (hover: none)":{boxShadow:"none"}},"&:active":{boxShadow:"0px 0px 0px 14px rgba(28, 132, 255, 0.16)"}},valueLabel:{left:"calc(-50% + 2px)","& *":{backgroundColor:"rgb(28, 132, 255)",color:"white"}},markLabel:{color:"white"},rail:{height:"10px",borderRadius:"5px"},track:{height:"10px",borderRadius:"5px"}})(je.a);function ze(t){var e=t.init,n=t.onChange,r=Object(i.useState)(e),a=Object(l.a)(r,2),o=a[0],s=a[1];return Object(b.jsxs)(ce,{children:["Mutation rate",Object(b.jsx)(pe,{value:o,min:0,max:1,step:.01,onChange:function(t,e){return s(e)},onChangeCommitted:n,valueLabelDisplay:"auto"})]})}function me(t){var e=t.init,n=t.onChange,r=Object(i.useState)(e),a=Object(l.a)(r,2),o=a[0],s=a[1];return Object(b.jsxs)(ce,{children:["Population size",Object(b.jsx)(pe,{value:o,min:1,max:250,step:1,onChange:function(t,e){return s(e)},onChangeCommitted:n,valueLabelDisplay:"auto"})]})}var Oe=n(349),ve=n.n(Oe);function we(t){var e=t.disabled,n=t.onClick;return Object(b.jsxs)(ce,{children:[Object(b.jsx)(At,{disabled:e,onClick:n,children:Object(b.jsx)(ve.a,{fontSize:"large"})}),"Restart training"]})}var ke=n(350),Se=n.n(ke);function Pe(t){var e=t.disabled,n=Object(o.b)();return Object(b.jsxs)(ce,{children:[Object(b.jsx)(At,{disabled:e,onClick:function(){n(ne())},children:Object(b.jsx)(Se.a,{fontSize:"large"})}),"Pretrained settings"]})}function Te(t){var e=t.init,n=t.populationSize,r=t.onChange,a=Object(i.useState)(e),o=Object(l.a)(a,2),s=o[0],c=o[1],u=Math.min(n,50);return Object(b.jsxs)(ce,{children:["Ghosts (decreases performance)",Object(b.jsx)(pe,{value:s,min:0,max:u,step:1,onChange:function(t,e){return c(e)},onChangeCommitted:r,valueLabelDisplay:"auto"})]})}var Ce,Re,Me,Ie,De,Le,Fe=new Worker("./simWorker/simWorker.js"),Ae={steerVal:-15,maxForce:3e3,maxBrakeForce:5,maxSpeed:100,stoppingDistance:100,slowDistance:100};function Ve(t){var e=t.training,n=Object(o.b)(),r=Object(i.useState)(1),a=Object(l.a)(r,2),s=a[0],c=a[1],u=Object(i.useState)(1),h=Object(l.a)(u,2),x=h[0],y=h[1],d=Object(i.useState)(null),g=Object(l.a)(d,2),f=g[0],j=g[1],p=Object(i.useState)(0),z=Object(l.a)(p,2),m=z[0],O=z[1],v=Object(i.useState)(0),w=Object(l.a)(v,2),k=w[0],S=w[1],P=Object(i.useState)(1),T=Object(l.a)(P,2),C=T[0],R=T[1],M=Object(i.useState)(100),I=Object(l.a)(M,2),D=I[0],L=I[1],F=Object(i.useState)(100),A=Object(l.a)(F,2),V=A[0],E=A[1],B=Object(i.useRef)(.01),_=Object(i.useRef)(20),G=Object(i.useRef)([]),N=Object(i.useRef)([]),W=Object(i.useCallback)((function(){Fe.postMessage("train"),L(0),console.time("timer")}),[]);!function(t,e,n){var r=Object(o.b)(),a=Object(i.useRef)(!1);Object(i.useEffect)((function(){e&&!a.current&&(a.current=!0,r(ne(t)),n())}),[r,e,n,t])}(Ae,e,W),Object(i.useEffect)((function(){Fe.onmessage=function(t){if(t.data.log)console.log(t.data.log);else if(t.data.progress)L(t.data.progress);else{var e=t.data,n=e.bestDNA,r=e.bestScore,i=e.avgScore,a=e.allDNA;j(n),O(Math.round(r)),S(Math.round(i)),L(100),N.current=a,console.timeEnd("timer")}}}),[n]);return Object(b.jsx)(b.Fragment,{children:e&&Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)(xe,{generation:C,score:s,avgScore:x}),Object(b.jsx)(ye,{progress:D}),Object(b.jsx)(ge,{disabled:D<100,onClick:function(){c(m),y(k),R((function(t){return t+1})),G.current=N.current,n(ne(f)),n(ie(G.current.slice(0,_.current))),W()}}),Object(b.jsx)(ze,{init:B.current,onChange:function(t,e){B.current=e,Fe.postMessage({mutationRate:e})}}),Object(b.jsx)(me,{init:V,onChange:function(t,e){E(e),Fe.postMessage({populationSize:e})}}),Object(b.jsx)(Te,{init:_.current,populationSize:V,onChange:function(t,e){G.current&&n(ie(G.current.slice(0,e))),_.current=e}}),Object(b.jsx)(we,{disabled:D<100,onClick:function(){Fe.postMessage({reset:!0}),n(ne(Ae)),n(ie([])),R(1),c(1),y(1),W()}}),Object(b.jsx)(Pe,{disabled:D<100})]})})}var Ee=y.b.div(Ce||(Ce=Object(x.a)(["\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  /* justify-content: space-between; */\n  margin: 5px 0;\n  padding: 5px;\n  width: 100%;\n  border-radius: 10px;\n  box-shadow: 0 0 10px -1px slategray;\n  height: 130px;\n"]))),Be=y.b.div(Re||(Re=Object(x.a)(["\n  display: flex;\n  align-items: flex-start;\n  justify-content: space-evenly;\n  width: 100%;\n  margin: 5px;\n"]))),_e=Object(y.b)(Ft.a)(Me||(Me=Object(x.a)(["\n  color: black;\n  box-shadow: ",";\n"])),(function(t){return t.enabled?"inset -4px -4px 8px rgba(255, 255, 255, 0.6), inset 8px 8px 16px rgba(0, 0, 0, 0.2)":"-6px -6px 10px rgba(255, 255, 255, 0.7), 6px 6px 10px rgba(0, 0, 0, 0.3)"})),Ge=(y.b.div(Ie||(Ie=Object(x.a)([""]))),y.b.div(De||(De=Object(x.a)([""]))),y.b.div(Le||(Le=Object(x.a)(["\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: space-between;\n  font-size: 0.9rem;\n  width: 33%;\n"])))),Ne=n(351),We=n.n(Ne);function Ue(t){var e=t.enabled,n=Object(o.b)();return Object(b.jsx)(Ge,{children:Object(b.jsx)(h.a,{title:"Keyboard",children:Object(b.jsx)(_e,{enabled:e?1:0,onClick:function(){n(Qt())},children:Object(b.jsx)(We.a,{})})})})}var Xe=n(352),qe=n.n(Xe);function Ze(t){var e=t.enabled,n=Object(o.b)();return Object(b.jsx)(Ge,{children:Object(b.jsx)(h.a,{title:"Mouse",children:Object(b.jsx)(_e,{enabled:e?1:0,onClick:function(){n(Jt())},children:Object(b.jsx)(qe.a,{})})})})}function He(){var t=Object(o.c)((function(t){return t.mode.mode}));return Object(b.jsxs)(Ee,{children:["Control method",Object(b.jsxs)(Be,{children:[Object(b.jsx)(Ue,{enabled:"keyboard"===t}),Object(b.jsx)(Ze,{enabled:"mouse"===t})]}),"keyboard"===t?"WASD to move, space to brake, r to reset":"Point and click to move, r to reset"]})}var Ye=n(353),Je=n.n(Ye);function Qe(t){var e=t.training,n=Object(o.b)();return Object(b.jsx)(b.Fragment,{children:Object(b.jsxs)(ce,{children:[Object(b.jsx)(At,{onClick:function(){n(function(){var t=Object(Zt.a)(qt.a.mark((function t(e,n){return qt.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n().training.training?(e(ie([])),e(ne())):(e(L()),e(Jt()),e(_()),e(E()),e(A(!1))),e(re());case 3:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())},children:Object(b.jsx)(Je.a,{fontSize:"large"})}),e?"Exit training":"Begin training"]})})}var Ke=n(354),$e=n.n(Ke),tn=n(355),en=n.n(tn),nn=n(356),rn=n.n(nn);function an(){var t=Object(o.c)((function(t){return t.settings.time})),e=Object(o.b)();return Object(b.jsx)(h.a,{title:"Toggle time of day",children:Object(b.jsx)(Vt,{onClick:function(){e(F())},children:{day:Object(b.jsx)($e.a,{}),sunset:Object(b.jsx)(en.a,{}),night:Object(b.jsx)(rn.a,{})}[t]})})}var on=n(357),sn=n.n(on);function cn(){var t=Object(o.b)(),e=Object(o.c)((function(t){return t.settings.addObstacles}));return Object(b.jsx)(b.Fragment,{children:Object(b.jsxs)(ce,{children:[Object(b.jsx)(At,{enabled:e?1:0,onClick:function(){t(A())},children:Object(b.jsx)(sn.a,{fontSize:"large"})}),"Add obstacles"]})})}var ln=n(358),un=n.n(ln);function hn(){var t=Object(o.b)();return Object(b.jsx)(b.Fragment,{children:Object(b.jsxs)(ce,{children:[Object(b.jsx)(At,{onClick:function(){t(E())},children:Object(b.jsx)(un.a,{fontSize:"large"})}),"Remove obstacles"]})})}var xn,yn=n(359),dn=n.n(yn);function bn(){var t=Object(o.b)(),e=Object(o.c)((function(t){return t.settings.AICar}));return Object(b.jsx)(b.Fragment,{children:Object(b.jsxs)(ce,{children:[Object(b.jsx)(At,{enabled:e?1:0,onClick:function(){t(B())},children:Object(b.jsx)(dn.a,{fontSize:"large"})}),"Neural network"]})})}var gn,fn={quality:null!==(xn=+localStorage.getItem("quality"))&&void 0!==xn&&xn},jn=Object(C.b)({name:"quality",initialState:fn,reducers:{setQuality:function(t,e){localStorage.setItem("quality",e.payload),t.quality=e.payload}}}),pn=jn.actions.setQuality,zn=jn.reducer,mn={3:"HQ",2:"MQ",1:"LQ"},On=y.b.div(gn||(gn=Object(x.a)(["\n  font-weight: 800;\n  font-size: 1.1rem;\n"])));function vn(){var t=Object(o.b)(),e=Object(o.c)((function(t){return t.quality.quality}));return Object(b.jsx)(h.a,{title:"Toggle graphics quality",children:Object(b.jsx)(Vt,{onClick:function(){var n=e-1;0===n&&(n+=3),t(pn(n))},children:Object(b.jsx)(On,{children:mn[e]})})})}var wn=Object(i.memo)((function(){var t=Object(i.useState)(!0),e=Object(l.a)(t,2),n=e[0],r=e[1],a=Object(o.c)((function(t){return t.training.training})),s=Object(o.c)((function(t){return t.settings.AICar})),c=Object(o.c)((function(t){return t.settings.obstacles}));return Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)(g,{setMenuOpen:r,menuOpen:n}),Object(b.jsx)(u.a,{variant:"persistent",anchor:"left",open:n,children:Object(b.jsxs)(oe,{children:[Object(b.jsxs)(se,{children:[Object(b.jsx)(vn,{}),Object(b.jsx)(an,{}),Object(b.jsx)(Et,{}),Object(b.jsx)(Rt,{})]}),!a&&Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)(He,{}),Object(b.jsx)(bn,{})]}),!s&&Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)(Ve,{training:a}),Object(b.jsx)(Qe,{training:a})]}),!a&&!s&&Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)(cn,{}),c.length>0&&Object(b.jsx)(hn,{})]})]})})]})})),kn=n(47),Sn=n(512),Pn=n(510),Tn=n(60),Cn=n(360),Rn=n.n(Cn),Mn=n(363),In=n(15),Dn=n(21),Ln=n(199),Fn={x:0,y:1,z:0};var An=function(t,e){var n,r;t.position.targetX=(n=e.rotation,r=e.position.x,-30*Math.cos(n)+r),t.position.targetY=20,t.position.targetZ=function(t,e){return 30*Math.sin(t)+e}(e.rotation,-e.position.y),t.target.targetX=e.position.x,t.target.targetY=0,t.target.targetZ=-e.position.y,t.up.targetX=0,t.up.targetY=1,t.up.targetZ=0};function Vn(t){var e=t.controls,n=t.camera,r=t.cameraLock,a=t.player,o=Object(i.useRef)({position:null,target:null,up:null}),s=Object(i.useRef)(null),c=Object(i.useRef)(0);Object(i.useEffect)((function(){void 0!==r&&a.position.x&&(o.current.position=Object(m.a)({},n.position),o.current.target=Object(m.a)({},e.current.target),o.current.up=Object(m.a)({},n.up),c.current=0,Object.values(o.current).forEach((function(t){return function(t){t.sourceX=t.x,t.sourceY=t.y,t.sourceZ=t.z}(t)})),s.current=r?"follow":"reset")}),[r,n,e,a]),Object(kn.f)((function(){s.current&&("follow"===s.current?u():l())}));var l=function(){if(c.current<1){var t,r,i;c.current+=.01;var l=Ln.b(c.current);!function(t,e,n,r){"move"===n?An(t,e):"reset"===n&&function(t,e){t.position.targetX=(null===e||void 0===e?void 0:e.position.x)||0,t.position.targetY=20,t.position.targetZ=30-(null===e||void 0===e?void 0:e.position.y)||0,t.target.targetX=(null===e||void 0===e?void 0:e.position.x)||0,t.target.targetY=0,t.target.targetZ=-(null===e||void 0===e?void 0:e.position.y)||0,t.up.targetX=0,t.up.targetY=1,t.up.targetZ=0}(t,e),Object.values(t).forEach((function(t){!function(t,e){void 0!==t.sourceX&&(t.x=(1-e)*t.sourceX+e*t.targetX,t.y=(1-e)*t.sourceY+e*t.targetY,t.z=(1-e)*t.sourceZ+e*t.targetZ)}(t,r)}))}(o.current,a,s.current,l),(t=n.position).set.apply(t,Object(Dn.a)(Object.values(o.current.position))),(r=e.current.target).set.apply(r,Object(Dn.a)(Object.values(o.current.target))),(i=n.up).set.apply(i,Object(Dn.a)(Object.values(o.current.up)))}else"move"===s.current?s.current="follow":s.current=!1},u=function(){a.followCam&&(n.position.lerp(a.followCam.getWorldPosition(a.followCamVector),.03),n.up.lerp(Fn,.03),e.current.target.lerp(a.followCam.parent.getWorldPosition(a.chassisVector),.03))}}function En(t){var e=t.cameraLock,n=t.player,r=t.isPaused,a=Object(i.useRef)(),o=Object(kn.h)(),s=o.camera,c=o.gl;return Object(kn.f)((function(){a.current.update(),r||Object(kn.e)()})),Object(i.useEffect)((function(){s.position.set(147.5,20,222.5),a.current.target.set(147.5,0,192.5)}),[s]),Vn({controls:a,camera:s,cameraLock:e,player:n}),Object(b.jsx)("trackballControls",{ref:a,args:[s,c.domElement],enableDamping:!0,dynamicDampingFactor:.1,maxDistance:3e3,mouseButtons:{LEFT:In.MOUSE.PAN,MIDDLE:In.MOUSE.ZOOM,RIGHT:In.MOUSE.ROTATE},keys:[]})}Object(kn.d)({TrackballControls:Mn.a});var Bn="0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\n0\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t0\n0\t1\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t1\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t1\t0\n0\t1\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t1\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t1\t0\n0\t1\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t1\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t1\t0\n0\t1\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t1\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t1\t0\n0\t1\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\tD\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t1\t0\n0\t1\t0\t0\t0\t1\t1\t1\t1\t1\t1\t1\t1\t1\tR\t1\tL\t1\t1\t1\t1\t1\t1\t1\t0\t0\t0\t0\t1\t0\n0\t1\t0\t0\t0\t1\t0\t0\t0\t0\t1\t0\t0\t0\t0\t0\t0\t0\t0\t0\t1\t0\t0\t1\t0\t0\t0\t0\t1\t0\n0\t1\t0\t0\t0\t1\t0\t0\t0\t0\t1\t0\t0\t0\t0\t0\t0\t0\t0\t0\t1\t0\t0\t1\t0\t0\t0\t0\t1\t0\n0\t1\t0\t0\t0\t1\t0\t0\t0\t0\tD\t0\t0\t0\t0\t0\t0\t0\t0\t0\tD\t0\t0\t1\t0\t0\t0\t0\t1\t0\n0\t1\t0\t0\t0\t1\t1\t1\t1\tR\t1\tL\t1\t1\t1\t1\t1\t1\t1\tR\t1\tL\t1\t1\t0\t0\t0\t0\t1\t0\n0\t1\t0\t0\t0\t1\t0\t0\t0\t0\tU\t0\t0\t0\t0\tU\t0\t0\t0\t0\tU\t0\t0\t1\t0\t0\t0\t0\t1\t0\n0\t1\t0\t0\t0\t1\t0\t0\t0\t0\t1\t0\t0\t0\t0\t1\t0\t0\t0\t0\t1\t0\t0\t1\t0\t0\t0\t0\t1\t0\n0\t1\t0\t0\t0\tD\t0\t0\t0\t0\tD\t0\t0\t0\t0\tD\t0\t0\t0\t0\tD\t0\t0\t1\t0\t0\t0\t0\t1\t0\n0\t1\t1\t1\tR\t1\tL\t1\t1\tR\t1\tL\t1\t1\tR\t1\tL\t1\t1\tR\t1\tL\tR\t1\tL\t1\t1\t1\t1\t0\n0\t1\t0\t0\t0\tU\t0\t0\t0\t0\tU\t0\t0\t0\t0\tU\t0\t0\t0\t0\tU\t0\t0\t1\t0\t0\t0\t0\t1\t0\n0\t1\t0\t0\t0\t1\t0\t0\t0\t0\t1\t0\t0\t0\t0\t1\t0\t0\t0\t0\t1\t0\t0\t1\t0\t0\t0\t0\t1\t0\n0\t1\t0\t0\t0\tD\t0\t0\t0\t0\tD\t0\t0\t0\t0\t1\t0\t0\t0\t0\t1\t0\t0\t1\t0\t0\t0\t0\t1\t0\n0\t1\t0\t0\t0\t1\tL\t1\t1\tR\t1\tL\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\tR\t1\t0\t0\t0\t0\t1\t0\n0\t1\t0\t0\t0\tU\t0\t0\t0\t0\t0\t0\t0\tU\t0\t0\t0\t0\tU\t0\t0\t0\t0\t1\t0\t0\t0\t0\t1\t0\n0\t1\t0\t0\t0\t1\t0\t0\t0\t0\t0\t0\t0\t1\t0\t0\t0\t0\t1\t0\t0\t0\t0\t1\t0\t0\t0\t0\t1\t0\n0\t1\t0\t0\t0\t1\t0\t0\t0\t0\t0\t0\t0\tD\t0\t0\t0\t0\tD\t0\t0\t0\t0\t1\t0\t0\t0\t0\t1\t0\n0\t1\t0\t0\t0\t1\t1\t1\t1\t1\t1\t1\tR\t1\tL\t1\t1\t1\t1\t1\t1\t1\t1\t1\t0\t0\t0\t0\t1\t0\n0\t1\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\tU\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t1\t0\n0\t1\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t1\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t1\t0\n0\t1\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t1\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t1\t0\n0\t1\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t1\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t1\t0\n0\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t1\t0\n0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0".split("\n").map((function(t){return t.split(/\s/).map((function(t){return"0"===t?0:t}))})),_n=Bn.map((function(t,e){return t.map((function(t,n){var r,i,a,o,s,c,l,u,h,x,y,d,b,g;return t?Bn[e][n-1]&&Bn[e][n+1]&&(null===(r=Bn[e+1])||void 0===r?void 0:r[n])&&(null===(i=Bn[e-1])||void 0===i?void 0:i[n])?"XR":Bn[e][n-1]&&Bn[e][n+1]&&(null===(a=Bn[e+1])||void 0===a?void 0:a[n])?"TB":Bn[e][n-1]&&Bn[e][n+1]&&(null===(o=Bn[e-1])||void 0===o?void 0:o[n])?"TT":Bn[e][n+1]&&(null===(s=Bn[e+1])||void 0===s?void 0:s[n])&&(null===(c=Bn[e-1])||void 0===c?void 0:c[n])?"TR":Bn[e][n-1]&&(null===(l=Bn[e+1])||void 0===l?void 0:l[n])&&(null===(u=Bn[e-1])||void 0===u?void 0:u[n])?"TL":Bn[e][n+1]&&(null===(h=Bn[e+1])||void 0===h?void 0:h[n])?"TLC":Bn[e][n-1]&&(null===(x=Bn[e+1])||void 0===x?void 0:x[n])?"TRC":Bn[e][n-1]&&(null===(y=Bn[e-1])||void 0===y?void 0:y[n])?"BRC":Bn[e][n+1]&&(null===(d=Bn[e-1])||void 0===d?void 0:d[n])?"BLC":Bn[e][n-1]&&Bn[e][n+1]?"HR":(null===(b=Bn[e+1])||void 0===b?void 0:b[n])&&(null===(g=Bn[e-1])||void 0===g?void 0:g[n])?"VR":t:0}))})),Gn={XR:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;t.fillRect(e,n,100,100)},HR:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;t.fillRect(e,n,100,100),t.strokeStyle="yellow";for(var r=1;r<100;r+=98)t.beginPath(),t.moveTo(e,n+r),t.lineTo(e+100,n+r),t.stroke();t.strokeStyle="white";for(var i=5;i<=100;i+=20)t.beginPath(),t.moveTo(e+i,n+50),t.lineTo(e+i+10,n+50),t.stroke()},TB:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;t.fillRect(e,n,100,100),t.strokeStyle="yellow",t.beginPath(),t.moveTo(e,n+1),t.lineTo(e+100,n+1),t.stroke(),t.strokeStyle="white";for(var r=5;r<=100;r+=20)t.beginPath(),t.moveTo(e+r,n+50),t.lineTo(e+r+10,n+50),t.stroke();t.beginPath(),t.moveTo(e,n+99),t.lineTo(e+50,n+99),t.stroke()},TT:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;t.fillRect(e,n,100,100),t.strokeStyle="yellow",t.beginPath(),t.moveTo(e,n+99),t.lineTo(e+100,n+99),t.stroke(),t.strokeStyle="white";for(var r=5;r<=100;r+=20)t.beginPath(),t.moveTo(e+r,n+50),t.lineTo(e+r+10,n+50),t.stroke();t.beginPath(),t.moveTo(e+50,n+1),t.lineTo(e+100,n+1),t.stroke()},VR:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;t.fillRect(e,n,100,100),t.strokeStyle="yellow";for(var r=1;r<100;r+=98)t.beginPath(),t.moveTo(e+r,n),t.lineTo(e+r,n+100),t.stroke();t.strokeStyle="white";for(var i=5;i<=100;i+=20)t.beginPath(),t.moveTo(e+50,n+i),t.lineTo(e+50,n+i+10),t.stroke()},TR:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;t.fillRect(e,n,100,100),t.strokeStyle="yellow",t.beginPath(),t.moveTo(e+1,n),t.lineTo(e+1,n+100),t.stroke(),t.strokeStyle="white";for(var r=5;r<=100;r+=20)t.beginPath(),t.moveTo(e+50,n+r),t.lineTo(e+50,n+r+10),t.stroke();t.beginPath(),t.moveTo(e+99,n+50),t.lineTo(e+99,n+100),t.stroke()},TL:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;t.fillRect(e,n,100,100),t.strokeStyle="yellow",t.beginPath(),t.moveTo(e+99,n),t.lineTo(e+99,n+100),t.stroke(),t.strokeStyle="white";for(var r=5;r<=100;r+=20)t.beginPath(),t.moveTo(e+50,n+r),t.lineTo(e+50,n+r+10),t.stroke();t.beginPath(),t.moveTo(e+1,n),t.lineTo(e+1,n+50),t.stroke()},TLC:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;t.fillRect(e,n,100,100),t.strokeStyle="yellow",t.beginPath(),t.moveTo(e,n+1),t.lineTo(e+100,n+1),t.stroke(),t.beginPath(),t.moveTo(e+1,n),t.lineTo(e+1,n+100),t.stroke(),t.strokeStyle="white";for(var r=15;r<=40;r+=20)t.beginPath(),t.moveTo(e+50,n+50+r),t.lineTo(e+50,n+50+r+10),t.stroke(),t.beginPath(),t.moveTo(e+50+r,n+50),t.lineTo(e+50+r+10,n+50),t.stroke();t.beginPath(),t.moveTo(e+50,n+50),t.lineTo(e+55,n+50),t.stroke(),t.beginPath(),t.moveTo(e+50,n+50),t.lineTo(e+50,n+55),t.stroke()},TRC:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;t.fillRect(e,n,100,100),t.strokeStyle="yellow",t.beginPath(),t.moveTo(e,n+1),t.lineTo(e+100,n+1),t.stroke(),t.beginPath(),t.moveTo(e+99,n),t.lineTo(e+99,n+100),t.stroke(),t.strokeStyle="white";for(var r=15;r<=40;r+=20)t.beginPath(),t.moveTo(e+50,n+50+r),t.lineTo(e+50,n+50+r+10),t.stroke(),t.beginPath(),t.moveTo(e+50-r,n+50),t.lineTo(e+50-r-10,n+50),t.stroke();t.beginPath(),t.moveTo(e+50,n+50),t.lineTo(e+45,n+50),t.stroke(),t.beginPath(),t.moveTo(e+50,n+50),t.lineTo(e+50,n+55),t.stroke()},BRC:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;t.fillRect(e,n,100,100),t.strokeStyle="yellow",t.beginPath(),t.moveTo(e,n+99),t.lineTo(e+100,n+99),t.stroke(),t.beginPath(),t.moveTo(e+99,n),t.lineTo(e+99,n+100),t.stroke(),t.strokeStyle="white";for(var r=15;r<=40;r+=20)t.beginPath(),t.moveTo(e+50,n+50-r),t.lineTo(e+50,n+50-r-10),t.stroke(),t.beginPath(),t.moveTo(e+50-r,n+50),t.lineTo(e+50-r-10,n+50),t.stroke();t.beginPath(),t.moveTo(e+50,n+50),t.lineTo(e+45,n+50),t.stroke(),t.beginPath(),t.moveTo(e+50,n+50),t.lineTo(e+50,n+45),t.stroke()},BLC:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;t.fillRect(e,n,100,100),t.strokeStyle="yellow",t.beginPath(),t.moveTo(e,n+99),t.lineTo(e+100,n+99),t.stroke(),t.beginPath(),t.moveTo(e+1,n),t.lineTo(e+1,n+100),t.stroke(),t.strokeStyle="white";for(var r=15;r<=40;r+=20)t.beginPath(),t.moveTo(e+50,n+50-r),t.lineTo(e+50,n+50-r-10),t.stroke(),t.beginPath(),t.moveTo(e+50+r,n+50),t.lineTo(e+50+r+10,n+50),t.stroke();t.beginPath(),t.moveTo(e+50,n+50),t.lineTo(e+55,n+50),t.stroke(),t.beginPath(),t.moveTo(e+50,n+50),t.lineTo(e+50,n+45),t.stroke()}};var Nn=new In.CanvasTexture(function(){var t=document.createElement("canvas");t.width=3e3,t.height=3e3;var e=t.getContext("2d");e.fillStyle="rgb(73, 73, 73)";for(var n=0;n<_n.length;n++)for(var r=0;r<_n[0].length;r++){var i=_n[n][r];i&&Gn[i](e,100*r,100*n)}return t}());function Wn(t){var e=t.tile;return Object(Tn.b)((function(){return{type:"Static",position:[e.x,0,e.z],args:[10,10,.01],rotation:[-Math.PI/2,0,0],collisionFilterGroup:1}})),Object(b.jsx)(b.Fragment,{})}function Un(t){var e=t.setSelectedVertex,n=t.addObstacles,r=t.onNewObstacle,a=Object(i.useRef)(null),o=Object(i.useMemo)((function(){for(var t=[],e=0;e<_n.length;e++)for(var n=0;n<_n[0].length;n++){_n[e][n]&&t.push({x:10*n,z:10*e})}return t}),[]),s=Object(i.useRef)();return Object(i.useEffect)((function(){s.current.updateMatrix()}),[s]),Object(b.jsxs)(b.Fragment,{children:[o.map((function(t,e){return Object(b.jsx)(Wn,{tile:t},e)})),Object(b.jsxs)("mesh",{ref:s,frustumCulled:!1,renderOrder:1,onPointerDown:function(t){a.current={x:t.clientX,y:t.clientY}},onPointerUp:function(t){a.current&&(Math.abs(a.current.x-t.clientX)+Math.abs(a.current.y-t.clientY)>10||(n?r({id:Date.now(),x:t.point.x,z:t.point.z}):e({x:t.point.x,z:t.point.z})))},matrixAutoUpdate:!1,position:[145,0,145],rotation:[-Math.PI/2,0,0],children:[Object(b.jsx)("planeBufferGeometry",{attach:"geometry",args:[300,300]}),Object(b.jsx)("meshStandardMaterial",{map:Nn,attach:"material",transparent:!0})]})]})}var Xn=n(266);function qn(t){var e=t.pathRef,n=t.vertices,r=t.color,i=t.width;return Object(b.jsxs)("mesh",{ref:e,children:[Object(b.jsx)("meshLine",{attach:"geometry",vertices:n,color:r}),Object(b.jsx)("meshLineMaterial",{attach:"material",lineWidth:i,color:r})]})}Object(kn.d)(Xn),Object(kn.d)(Xn);var Zn=Object(i.memo)((function(t){var e=t.player,n=Object(i.useRef)();return Object(i.useEffect)((function(){e.pathGeometry=n.current.geometry}),[e]),Object(b.jsx)(qn,{pathRef:n,vertices:[],color:"lightblue",width:.3})}));function Hn(t){var e=t.selectedVertex,n=Object(i.useState)(!1),r=Object(l.a)(n,2),a=r[0],o=r[1],s=Object(i.useRef)(!1),c=Object(i.useRef)();return Object(i.useEffect)((function(){e&&o(!0)}),[e]),Object(kn.f)((function(){a&&(c.current.scale.x>1&&(s.current=!0),c.current.scale.x+=s.current?-.2:.2,c.current.scale.z+=s.current?-.2:.2,c.current.scale.x<0&&(c.current.scale.x=0,c.current.scale.z=0,s.current=!1,o(!1)))})),Object(b.jsx)(b.Fragment,{children:a&&Object(b.jsxs)("mesh",{frustumCulled:!1,position:[e.x,.1,e.z],scale:0,renderOrder:10,ref:c,children:[Object(b.jsx)("sphereBufferGeometry",{attach:"geometry",args:[1.5,36]}),Object(b.jsx)("meshBasicMaterial",{color:"lightgreen",attach:"material"})]})})}var Yn=n.p+"static/media/aston2.c4267f8a.glb",Jn=n(508);function Qn(t){var e=Object(i.useRef)(),n=Object(Jn.a)(Yn),r=n.nodes,a=n.materials;return Object(b.jsxs)("group",Object(m.a)(Object(m.a)({ref:e},t),{},{dispose:null,children:[Object(b.jsx)("group",{position:[0,84.49,96.3],rotation:[-Math.PI/2,0,0],children:Object(b.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:r.object014_refl_0.geometry,material:a["refl.001"]})}),Object(b.jsx)("group",{position:[0,65.27,175.92],rotation:[-Math.PI/2,0,0],children:Object(b.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:r.object013_lightchr_0.geometry,material:a["lightchr.001"]})}),Object(b.jsx)("group",{position:[0,84,-204.52],rotation:[-Math.PI/2,0,0],children:Object(b.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:r.object011_remit_0.geometry,material:a["remit.001"]})}),Object(b.jsx)("group",{position:[0,84,-203.13],rotation:[-Math.PI/2,0,0],children:Object(b.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:r.object010_red_0.geometry,material:a.material})}),Object(b.jsx)("group",{position:[0,67.32,-.74],rotation:[-Math.PI/2,0,0],children:Object(b.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:r.object009_glack_0.geometry,material:a["glack.001"]})}),Object(b.jsx)("group",{position:[0,105.73,-55.81],rotation:[-Math.PI/2,0,0],children:Object(b.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:r.object007_GLASS_0.geometry,material:a["GLASS.001"]})}),Object(b.jsx)("group",{position:[0,74.41,-9.69],rotation:[-Math.PI/2,0,0],children:Object(b.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:r.object006_LightsGlassFront_0.geometry,material:a["LightsGlassFront.001"]})}),Object(b.jsx)("group",{position:[0,61.69,-25.09],rotation:[-Math.PI/2,0,0],children:Object(b.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:r.object005_red2_0.geometry,material:a["red2.001"]})}),Object(b.jsx)("group",{position:[0,62.74,187.82],rotation:[-Math.PI/2,0,0],children:Object(b.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:r.object004_xenon_0.geometry,material:a["xenon.001"]})}),Object(b.jsx)("group",{position:[0,77.71,-7.05],rotation:[-Math.PI/2,0,0],children:Object(b.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:r.object003_Chrome_0.geometry,material:a["Chrome.003"]})}),Object(b.jsx)("group",{position:[0,53.75,-2.62],rotation:[-Math.PI/2,0,0],children:Object(b.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:r.object002_flack_0.geometry,material:a["flack.001"]})}),Object(b.jsx)("group",{position:[0,73.11,-2.23],rotation:[-Math.PI/2,0,0],children:Object(b.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:r.object000_WhitePaint_0.geometry,material:a["WhitePaint.001"]})}),Object(b.jsx)("group",{position:[.04,35.27,204.94],rotation:[-Math.PI/2,0,0],children:Object(b.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:r.object012_grill_0.geometry,material:a["grill.001"]})}),Object(b.jsx)("group",{position:[0,110.59,-97.11],rotation:[-Math.PI/2,0,0],children:Object(b.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:r.object001_BlackPaint_0.geometry,material:a["BlackPaint.001"]})})]}))}Jn.a.preload(Yn);var Kn=n.p+"static/media/aston.ec36e04c.glb";function $n(t){var e=Object(i.useRef)(),n=Object(Jn.a)(Kn),r=n.nodes,a=n.materials;return Object(b.jsxs)("group",Object(m.a)(Object(m.a)({ref:e},t),{},{dispose:null,children:[Object(b.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:r.mesh_0.geometry,material:r.mesh_0.material,position:[0,1.1,1.54],rotation:[-Math.PI/2,0,0]}),Object(b.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:r.mesh_1.geometry,material:r.mesh_1.material,position:[0,1.1,1.54],rotation:[-Math.PI/2,0,0]}),Object(b.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:r.mesh_2.geometry,material:r.mesh_2.material,position:[0,1.1,1.54],rotation:[-Math.PI/2,0,0]}),Object(b.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:r.mesh_3.geometry,material:a.refl,position:[0,1.1,1.54],rotation:[-Math.PI/2,0,0]}),Object(b.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:r.mesh_4.geometry,material:a.lightchr,position:[0,1.1,1.54],rotation:[-Math.PI/2,0,0]}),Object(b.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:r.mesh_5.geometry,material:a.remit,position:[0,1.1,1.54],rotation:[-Math.PI/2,0,0]}),Object(b.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:r.mesh_6.geometry,material:a.material,position:[0,1.1,1.54],rotation:[-Math.PI/2,0,0]}),Object(b.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:r.mesh_7.geometry,material:a.glack,position:[0,1.1,1.54],rotation:[-Math.PI/2,0,0]}),Object(b.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:r.mesh_8.geometry,material:a.GLASS,position:[0,1.1,1.54],rotation:[-Math.PI/2,0,0]}),Object(b.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:r.mesh_9.geometry,material:a.LightsGlassFront,position:[0,1.1,1.54],rotation:[-Math.PI/2,0,0]}),Object(b.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:r.mesh_10.geometry,material:a.red2,position:[0,1.1,1.54],rotation:[-Math.PI/2,0,0]}),Object(b.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:r.mesh_11.geometry,material:a.xenon,position:[0,1.1,1.54],rotation:[-Math.PI/2,0,0]}),Object(b.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:r.mesh_12.geometry,material:a.Chrome,position:[0,1.1,1.54],rotation:[-Math.PI/2,0,0]}),Object(b.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:r.mesh_13.geometry,material:a.flack,position:[0,1.1,1.54],rotation:[-Math.PI/2,0,0]}),Object(b.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:r.mesh_14.geometry,material:a.WhitePaint,position:[0,1.1,1.54],rotation:[-Math.PI/2,0,0]}),Object(b.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:r.mesh_16.geometry,material:a.BlackPaint,position:[0,1.1,1.54],rotation:[-Math.PI/2,0,0]}),Object(b.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:r.mesh_17.geometry,material:r.mesh_17.material,position:[0,1.1,1.54],rotation:[-Math.PI/2,0,0]}),Object(b.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:r.mesh_15.geometry,material:r.mesh_15.material,position:[0,1.1,1.54],rotation:[-Math.PI/2,0,0]})]}))}Jn.a.preload(Kn);var tr=n(92);function er(t){var e=t.from,n=t.to,r=t.angle,a=t.playerRef,o=Object(i.useRef)(new In.BufferGeometry),s=Object(i.useRef)(),c=Object(i.useRef)(),u=Object(i.useRef)(new In.Vector3),h=Object(i.useRef)(new In.Vector3),x=Object(i.useState)("limegreen"),y=Object(l.a)(x,2),d=y[0],g=y[1],f=Object(i.useState)(e),j=Object(l.a)(f,2),p=j[0],z=j[1],m=Object(i.useState)(n),O=Object(l.a)(m,2),v=O[0],w=O[1];return Object(Tn.d)({from:p,to:v,collisionFilterGroup:2,collisionFilterMask:5},(function(t){var e,n;"obstacle"===(null===(e=t.body)||void 0===e?void 0:e.userData.id)?(a.current.obstacles[r]=[t.distance,1],g("red")):"wall"===(null===(n=t.body)||void 0===n?void 0:n.userData.id)&&(a.current.obstacles[r]=[t.distance,0],g("blue"))}),[p,v]),Object(kn.f)((function(){c.current&&(g("limegreen"),c.current.getWorldPosition(u.current),s.current.getWorldPosition(h.current),w([h.current.x,0,h.current.z]),z([u.current.x,.5,u.current.z]))})),Object(i.useEffect)((function(){o.current.setFromPoints([e,n].map((function(t){return Object(tr.a)(In.Vector3,Object(Dn.a)(t))})))}),[e,n]),Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)("object3D",{ref:c,position:e}),Object(b.jsx)("object3D",{ref:s,position:n}),Object(b.jsx)("line",{geometry:o.current,children:Object(b.jsx)("lineBasicMaterial",{color:d})})]})}var nr=[0,0,0],rr=function(t,e,n){var r=new In.EllipseCurve(0,0,t,t,Math.PI/2-e/2,Math.PI/2+e/2,!1,0).getPoints(n),i=e/n,a=e/2;return r.map((function(t){var e=[t.x,0,t.y],n=a;return a-=i,{pos:e,angle:n}}))}(20,Math.PI/1.5,30);function ir(t){var e=t.playerRef,n=t.obstacles;return Object(b.jsx)(b.Fragment,{children:n.length>0&&Object(b.jsxs)(b.Fragment,{children:[rr.map((function(t,n){return Object(b.jsx)(er,{from:nr,to:t.pos,angle:t.angle,playerRef:e},n)})),";"]})})}function ar(t){var e=t.rotation,n=t.position,r=t.angularVelocity,a=t.followCameraRef,o=t.chassisRef,s=t.time,c=t.playerRef,u=t.obstacles,h=t.quality,x=Object(i.useRef)(),y=Object(i.useState)(void 0),d=Object(l.a)(y,2),g=d[0],f=d[1],j=[1.7,1,4],p=Object(Tn.b)((function(){return{mass:500,position:n,rotation:e,angularVelocity:r,args:j,collisionFilterGroup:2,collisionFilterMask:1,userData:{id:"playerCar"}}}),o),z=Object(l.a)(p,2)[1];return Object(i.useEffect)((function(){f(x.current)}),[]),Object(b.jsxs)("mesh",{ref:o,api:z,children:[Object(b.jsx)(ir,{playerRef:c,obstacles:u}),3===h?Object(b.jsx)(Qn,{position:[0,-.7,0],scale:.01}):Object(b.jsx)($n,{position:[0,-.7,0],scale:.01}),Object(b.jsx)("object3D",{ref:a,position:[0,3,-8]}),Object(b.jsx)("object3D",{ref:x,position:[0,-2,10]}),"night"===s&&Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)("spotLight",{position:[-.8,-.15,1.9],intensity:8,target:g,distance:20,angle:.5,penumbra:.4,color:"rgb(24, 235, 254)"}),Object(b.jsx)("spotLight",{position:[.8,-.15,1.9],intensity:8,target:g,distance:20,angle:.5,penumbra:.4,color:"rgb(24, 235, 254)"})]})]})}var or=n.p+"static/media/wheel.d7a0342f.glb";function sr(t){var e=Object(Jn.a)(or),n=e.nodes,r=e.materials;return Object(b.jsxs)("group",Object(m.a)(Object(m.a)({},t),{},{dispose:null,children:[Object(b.jsx)("mesh",{material:r.Rubber,geometry:n.wheel_1.geometry}),Object(b.jsx)("mesh",{material:r.Steel,geometry:n.wheel_2.geometry}),Object(b.jsx)("mesh",{material:r.Chrom,geometry:n.wheel_3.geometry})]}))}Jn.a.preload(or);var cr=Object(i.forwardRef)((function(t,e){var n=t.leftSide;return Object(Tn.c)((function(){return{mass:1,type:"Kinematic",collisionFilterGroup:0}}),e),Object(b.jsx)("mesh",{ref:e,children:Object(b.jsx)("mesh",{rotation:[0,0,(n?1:-1)*Math.PI/2],children:Object(b.jsx)(sr,{})})})})),lr=-.15,ur={radius:.3,directionLocal:[0,-1,0],suspensionStiffness:30,suspensionRestLength:.3,maxSuspensionForce:1e4,maxSuspensionTravel:.3,dampingRelaxation:2.3,dampingCompression:4.4,frictionSlip:5,rollInfluence:.01,axleLocal:[-1,0,0],chassisConnectionPointLocal:[1,0,1],isFrontWheel:!1,useCustomSlidingRotationalSpeed:!0,customSlidingRotationalSpeed:-30},hr=function(){var t=Object(i.useRef)(),e=Object(i.useRef)(),n=Object(i.useRef)(),r=Object(i.useRef)();return[Object(i.useMemo)((function(){return[t,e,n,r]}),[]),Object(i.useMemo)((function(){return[Object(m.a)(Object(m.a)({},ur),{},{chassisConnectionPointLocal:[-.8,lr,1.3],isFrontWheel:!0}),Object(m.a)(Object(m.a)({},ur),{},{chassisConnectionPointLocal:[.8,lr,1.3],isFrontWheel:!0}),Object(m.a)(Object(m.a)({},ur),{},{chassisConnectionPointLocal:[-.8,lr,-1.35],isFrontWheel:!1}),Object(m.a)(Object(m.a)({},ur),{},{chassisConnectionPointLocal:[.8,lr,-1.35],isFrontWheel:!1})]}),[])]};function xr(t){var e=t.chassisRef,n=t.vehicleRef,r=t.followCameraRef,i=t.position,a=t.rotation,o=t.angularVelocity,s=t.time,c=t.playerRef,u=t.obstacles,h=t.quality,x=hr(),y=Object(l.a)(x,2),d=y[0],g=y[1],f=Object(Tn.e)((function(){return{chassisBody:e,wheels:d,wheelInfos:g,indexForwardAxis:2,indexRightAxis:0,indexUpAxis:1}}),n),j=Object(l.a)(f,2)[1];return Object(b.jsxs)("group",{ref:n,api:j,children:[Object(b.jsx)(ar,{chassisRef:e,followCameraRef:r,rotation:a,position:i,angularVelocity:o,time:s,playerRef:c,obstacles:u,quality:h}),Object(b.jsx)(cr,{ref:d[0],leftSide:!0}),Object(b.jsx)(cr,{ref:d[1]}),Object(b.jsx)(cr,{ref:d[2],leftSide:!0}),Object(b.jsx)(cr,{ref:d[3]})]})}function yr(t,e){var n=Object(i.useState)(!1),r=Object(l.a)(n,2),a=r[0],o=r[1],s=function(e){return e.preventDefault(),e.key===t?o(!0):null},c=function(e){return e.key===t?o(!1):null};return Object(i.useEffect)((function(){if("keyboard"===e)return window.addEventListener("keydown",s),window.addEventListener("keyup",c),function(){window.removeEventListener("keydown",s),window.removeEventListener("keyup",c)}}),[e]),a}var dr,br=function(t,e,n,r,a,o,s,c){var l=Object(i.useCallback)((function(){t.current.api.position.set(147.5,4,192.5),t.current.api.angularVelocity.set(0,0,0),t.current.api.velocity.set(0,0,0),t.current.api.rotation.set(0,Math.PI,0)}),[t]);!function(t,e,n,r,i){var a=yr("w",t),o=yr("s",t),s=yr("a",t),c=yr("d",t),l=yr(" ",t),u=yr("r","keyboard");Object(kn.f)((function(){var h;if(u&&(n(),r()),"keyboard"===t&&(null===(h=e.current)||void 0===h?void 0:h.api)){var x=0,y=0,d=0;s&&!c?x=.5:c&&!s&&(x=-.5),a&&!o?d=-1500:o&&!a&&(d=1500),l&&(y=50),e.current.api.applyEngineForce(d,2),e.current.api.applyEngineForce(d,3),e.current.api.setSteeringValue(x,0),e.current.api.setSteeringValue(x,1);for(var b=0;b<4;b++)e.current.api.setBrake(y,b);i({steering:2*-x,accel:y?-1:d?-d/1500:0})}}))}(r,e,l,(function(){n.current.arrayOfSteps=[],n.current.pathGeometry.setVertices([])}),a),function(t,e,n,r,a){var o=Object(i.useRef)();Object(i.useEffect)((function(){"keyboard"!==n?t&&t!==o.current&&(o.current=t,e.current.click(t)):e.current.clearPath()}),[n,t,e]),Object(kn.f)((function(){var t;if("mouse"===n&&(null===(t=r.current)||void 0===t?void 0:t.api)){var i=e.current.run();if(i){var o=i.forces,s=i.gauges,c=o.steering,l=o.engine,u=o.braking;r.current.api.applyEngineForce(l,2),r.current.api.applyEngineForce(l,3),r.current.api.setSteeringValue(c,0),r.current.api.setSteeringValue(c,1);for(var h=0;h<4;h++)r.current.api.setBrake(u,h);a(s)}}}),-1)}(o,n,r,e,a),Object(i.useEffect)((function(){var t,e;l(),s&&(null===(t=(e=n.current).updateDNA)||void 0===t||t.call(e,s))}),[n,s,l,c])};function gr(t){var e=t.selectedVertex,n=t.mode,r=t.player,a=t.setGauges,o=t.currentDNA,s=t.time,c=t.obstacles,l=t.useAICar,u=t.quality,h=Object(i.useRef)(r),x=Object(i.useRef)(),y=Object(i.useRef)(),d=Object(i.useRef)();return function(t,e){Object(i.useEffect)((function(){e.current.api.position.subscribe((function(e){t.current.position.set(e[0],-e[2])})),e.current.api.velocity.subscribe((function(e){var n;(n=t.current.velocityVector).set.apply(n,Object(Dn.a)(e)),t.current.velocity=t.current.velocityVector.length()})),e.current.api.rotation.subscribe((function(e){t.current.rotation=e[1]-Math.PI/2}))}),[e,t])}(h,x),br(x,d,h,n,a,e,o,l),Object(i.useEffect)((function(){h.current=r,r.followCam=y.current}),[r,y]),Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)(xr,{chassisRef:x,vehicleRef:d,followCameraRef:y,position:[147.5,4,192.5],angularVelocity:[0,0,0],rotation:[0,Math.PI,0],time:s,playerRef:h,obstacles:c,quality:u}),Object(b.jsx)(Zn,{player:r}),Object(b.jsx)(Hn,{selectedVertex:e})]})}var fr=y.b.div(dr||(dr=Object(x.a)(["\n  position: absolute;\n  width: 100%;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background-color: skyblue;\n  cursor: ",";\n"])),(function(t){return t.cursorTarget?"crosshair":""})),jr={U:1,D:1,L:2,R:2},pr={U:-2.5,D:2.5,L:-4,R:4},zr={U:-4,D:4,L:2.5,R:-2.5},mr={U:.5*Math.PI,D:.5*Math.PI,L:0,R:0},Or={U:0,D:3,L:2,R:1},vr=[];Bn.forEach((function(t,e){t.forEach((function(t,n){t&&"1"!==t&&vr.push({i:e,j:n,z:10*e+zr[t],x:10*n+pr[t],rotation:mr[t],lightSet:jr[t],index:Or[t],key:"".concat(e,":").concat(n)})}))}));for(var wr,kr,Sr,Pr=n(16),Tr=n(1),Cr=n(9),Rr=n(200),Mr=function(){function t(){Object(Tr.a)(this,t),this.heapList=[null],this.count=0}return Object(Cr.a)(t,[{key:"add",value:function(t){this.count++,this.heapList.push(t),this.heapifyUp()}},{key:"heapifyUp",value:function(){for(var t=this.count;this.parentIndex(t)>0;){var e=this.heapList[t],n=this.heapList[this.parentIndex(t)];n.totalDistance>e.totalDistance&&(this.heapList[t]=n,this.heapList[this.parentIndex(t)]=e),t=this.parentIndex(t)}}},{key:"heapifyDown",value:function(){for(var t=1;this.childExists(t);){var e=this.getSmallerChildIndex(t),n=this.heapList[t],r=this.heapList[e];n.distance>r.distance&&(this.heapList[e]=n,this.heapList[t]=r),t=e}}},{key:"retrieveMin",value:function(){if(0===this.count)return null;var t=this.heapList[1];return this.heapList[1]=this.heapList[this.count],this.count--,this.heapList.pop(),this.heapifyDown(),t}},{key:"parentIndex",value:function(t){return Math.floor(t/2)}},{key:"leftChildIndex",value:function(t){return 2*t}},{key:"rightChildIndex",value:function(t){return 2*t+1}},{key:"getSmallerChildIndex",value:function(t){if(this.rightChildIndex(t)>this.count)return this.leftChildIndex(t);var e=this.heapList[this.leftChildIndex(t)],n=this.heapList[this.rightChildIndex(t)];return e.distance<n.distance?this.leftChildIndex(t):this.rightChildIndex(t)}},{key:"childExists",value:function(t){return this.leftChildIndex(t)<=this.count}}]),t}(),Ir=function(t,e,n){var r={};for(var i in t)r[i]={totalDistance:1/0,path:[e]};r[e]={totalDistance:0,path:[e]};var a=new Mr;a.add({distance:0,vertex:e,path:[e]});for(var o=1/0;a.count;){var s,c=a.retrieveMin(),u=c.distance,h=c.vertex,x=c.path,y=Object(Pr.a)(t[h].edges);try{for(y.s();!(s=y.n()).done;){var d=s.value,b=Object(l.a)(d,2),g=b[0],f=u+b[1],j=[].concat(Object(Dn.a)(x),[g]);f>=r[g].totalDistance||f>o||(r[g].totalDistance=f,r[g].path=j,g===n&&f<o?o=f:a.add({distance:f,vertex:g,path:j}))}}catch(p){y.e(p)}finally{y.f()}}return r[n]},Dr=function(t,e,n,r,i,a){var o=Lr(t,-e,n,-r,i,-a),s=o.startAngle,c=o.endAngle,l=o.clockwise;return new In.EllipseCurve(t,-e,2.5,2.5,s,c,l,0).getPoints(10)},Lr=function(t,e,n,r,i,a){switch(!0){case n>t&&n>i&&r>a:return{startAngle:0,endAngle:3*Math.PI/2,clockwise:!0};case r<e&&n>i&&r<a:return{startAngle:3*Math.PI/2,endAngle:Math.PI,clockwise:!0};case n<t&&n<i&&r<a:return{startAngle:Math.PI,endAngle:Math.PI/2,clockwise:!0};case r>e&&n<i&&r>a:return{startAngle:Math.PI/2,endAngle:0,clockwise:!0};case n>t&&n>i&&r<a:return{startAngle:0,endAngle:Math.PI/2,clockwise:!1};case r>e&&n>i&&r>a:return{startAngle:Math.PI/2,endAngle:Math.PI,clockwise:!1};case n<t&&n<i&&r>a:return{startAngle:Math.PI,endAngle:3*Math.PI/2,clockwise:!1};case r<e&&n<i&&r<a:return{startAngle:3*Math.PI/2,endAngle:0,clockwise:!1}}},Fr=[{x:147.5,y:.5,z:7.5},{x:147.5,y:.5,z:8},{x:147.5,y:.5,z:8.5},{x:147.5,y:.5,z:9},{x:147.5,y:.5,z:9.5},{x:147.5,y:.5,z:10},{x:147.5,y:.5,z:10.5},{x:147.5,y:.5,z:11},{x:147.5,y:.5,z:11.5},{x:147.5,y:.5,z:12},{x:147.5,y:.5,z:12.5},{x:147.5,y:.5,z:13},{x:147.5,y:.5,z:13.5},{x:147.5,y:.5,z:14},{x:147.5,y:.5,z:14.5},{x:147.5,y:.5,z:15},{x:147.5,y:.5,z:15.5},{x:147.5,y:.5,z:16},{x:147.5,y:.5,z:16.5},{x:147.5,y:.5,z:17},{x:147.5,y:.5,z:17.5},{x:147.5,y:.5,z:18},{x:147.5,y:.5,z:18.5},{x:147.5,y:.5,z:19},{x:147.5,y:.5,z:19.5},{x:147.5,y:.5,z:20},{x:147.5,y:.5,z:20.5},{x:147.5,y:.5,z:21},{x:147.5,y:.5,z:21.5},{x:147.5,y:.5,z:22},{x:147.5,y:.5,z:22.5},{x:147.5,y:.5,z:23},{x:147.5,y:.5,z:23.5},{x:147.5,y:.5,z:24},{x:147.5,y:.5,z:24.5},{x:147.5,y:.5,z:25},{x:147.5,y:.5,z:25.5},{x:147.5,y:.5,z:26},{x:147.5,y:.5,z:26.5},{x:147.5,y:.5,z:27},{x:147.5,y:.5,z:27.5},{x:147.5,y:.5,z:28},{x:147.5,y:.5,z:28.5},{x:147.5,y:.5,z:29},{x:147.5,y:.5,z:29.5},{x:147.5,y:.5,z:30},{x:147.5,y:.5,z:30.5},{x:147.5,y:.5,z:31},{x:147.5,y:.5,z:31.5},{x:147.5,y:.5,z:32},{x:147.5,y:.5,z:32.5},{x:147.5,y:.5,z:33},{x:147.5,y:.5,z:33.5},{x:147.5,y:.5,z:34},{x:147.5,y:.5,z:34.5},{x:147.5,y:.5,z:35},{x:147.5,y:.5,z:35.5},{x:147.5,y:.5,z:36},{x:147.5,y:.5,z:36.5},{x:147.5,y:.5,z:37},{x:147.5,y:.5,z:37.5},{x:147.5,y:.5,z:38},{x:147.5,y:.5,z:38.5},{x:147.5,y:.5,z:39},{x:147.5,y:.5,z:39.5},{x:147.5,y:.5,z:40},{x:147.5,y:.5,z:40.5},{x:147.5,y:.5,z:41},{x:147.5,y:.5,z:41.5},{x:147.5,y:.5,z:42},{x:147.5,y:.5,z:42.5},{x:147.5,y:.5,z:43},{x:147.5,y:.5,z:43.5},{x:147.5,y:.5,z:44},{x:147.5,y:.5,z:44.5},{x:147.5,y:.5,z:45},{x:147.5,y:.5,z:45.5},{x:147.5,y:.5,z:46},{x:147.5,y:.5,z:46.5},{x:147.5,y:.5,z:47},{x:147.5,y:.5,z:47.5},{x:147.5,y:.5,z:48},{x:147.5,y:.5,z:48.5},{x:147.5,y:.5,z:49},{x:147.5,y:.5,z:49.5},{x:147.5,y:.5,z:50},{x:147.5,y:.5,z:50.5},{x:147.5,y:.5,z:51},{x:147.5,y:.5,z:51.5},{x:147.5,y:.5,z:52},{x:147.5,y:.5,z:52.5},{x:147.5,y:.5,z:53},{x:147.5,y:.5,z:53.5},{x:147.5,y:.5,z:54},{x:147.5,y:.5,z:54.5},{x:147.5,y:.5,z:55},{x:147.5,y:.5,z:55.5},{x:147.5,y:.5,z:56},{x:147.5,y:.5,z:56.5},{x:147.5,y:.5,z:57},{x:147.5,y:.5,z:57.5},{x:147.5,y:.5,z:58},{x:147.5,y:.5,z:58.5},{x:147.5,y:.5,z:59},{x:147.5,y:.5,z:59.5},{x:147.5,y:.5,z:60},{x:147.5,y:.5,z:60.5},{x:147.5,y:.5,z:61},{x:147.5,y:.5,z:61.5},{x:147.5,y:.5,z:62},{x:147.5,y:.5,z:62.5},{x:147.5,y:.5,z:63},{x:147.5,y:.5,z:63.5},{x:147.5,y:.5,z:64},{x:147.5,y:.5,z:64.5},{x:147.5,y:.5,z:65},{x:147.46922085148785,y:.5,z:65.39108616260057},{x:147.37764129073787,y:.5,z:65.77254248593736},{x:147.22751631047092,y:.5,z:66.13497624934887},{x:147.02254248593738,y:.5,z:66.46946313073119},{x:146.76776695296635,y:.5,z:66.76776695296637},{x:146.46946313073119,y:.5,z:67.02254248593736},{x:146.13497624934885,y:.5,z:67.22751631047092},{x:145.77254248593738,y:.5,z:67.37764129073788},{x:145.39108616260057,y:.5,z:67.46922085148785,turn:!0},{x:145,y:.5,z:67.5},{x:144.5,y:.5,z:67.5},{x:144,y:.5,z:67.5},{x:143.5,y:.5,z:67.5},{x:143,y:.5,z:67.5},{x:142.5,y:.5,z:67.5},{x:142,y:.5,z:67.5},{x:141.5,y:.5,z:67.5},{x:141,y:.5,z:67.5},{x:140.5,y:.5,z:67.5},{x:140,y:.5,z:67.5},{x:139.5,y:.5,z:67.5},{x:139,y:.5,z:67.5},{x:138.5,y:.5,z:67.5},{x:138,y:.5,z:67.5},{x:137.5,y:.5,z:67.5},{x:137,y:.5,z:67.5},{x:136.5,y:.5,z:67.5},{x:136,y:.5,z:67.5},{x:135.5,y:.5,z:67.5},{x:135,y:.5,z:67.5},{x:134.5,y:.5,z:67.5},{x:134,y:.5,z:67.5},{x:133.5,y:.5,z:67.5},{x:133,y:.5,z:67.5},{x:132.5,y:.5,z:67.5},{x:132,y:.5,z:67.5},{x:131.5,y:.5,z:67.5},{x:131,y:.5,z:67.5},{x:130.5,y:.5,z:67.5},{x:130,y:.5,z:67.5},{x:129.5,y:.5,z:67.5},{x:129,y:.5,z:67.5},{x:128.5,y:.5,z:67.5},{x:128,y:.5,z:67.5},{x:127.5,y:.5,z:67.5},{x:127,y:.5,z:67.5},{x:126.5,y:.5,z:67.5},{x:126,y:.5,z:67.5},{x:125.5,y:.5,z:67.5},{x:125,y:.5,z:67.5},{x:124.5,y:.5,z:67.5},{x:124,y:.5,z:67.5},{x:123.5,y:.5,z:67.5},{x:123,y:.5,z:67.5},{x:122.5,y:.5,z:67.5},{x:122,y:.5,z:67.5},{x:121.5,y:.5,z:67.5},{x:121,y:.5,z:67.5},{x:120.5,y:.5,z:67.5},{x:120,y:.5,z:67.5},{x:119.5,y:.5,z:67.5},{x:119,y:.5,z:67.5},{x:118.5,y:.5,z:67.5},{x:118,y:.5,z:67.5},{x:117.5,y:.5,z:67.5},{x:117,y:.5,z:67.5},{x:116.5,y:.5,z:67.5},{x:116,y:.5,z:67.5},{x:115.5,y:.5,z:67.5},{x:115,y:.5,z:67.5},{x:114.5,y:.5,z:67.5},{x:114,y:.5,z:67.5},{x:113.5,y:.5,z:67.5},{x:113,y:.5,z:67.5},{x:112.5,y:.5,z:67.5},{x:112,y:.5,z:67.5},{x:111.5,y:.5,z:67.5},{x:111,y:.5,z:67.5},{x:110.5,y:.5,z:67.5},{x:110,y:.5,z:67.5},{x:109.5,y:.5,z:67.5},{x:109,y:.5,z:67.5},{x:108.5,y:.5,z:67.5},{x:108,y:.5,z:67.5},{x:107.5,y:.5,z:67.5},{x:107,y:.5,z:67.5},{x:106.5,y:.5,z:67.5},{x:106,y:.5,z:67.5},{x:105.5,y:.5,z:67.5},{x:105,y:.5,z:67.5},{x:104.5,y:.5,z:67.5},{x:104,y:.5,z:67.5},{x:103.5,y:.5,z:67.5},{x:103,y:.5,z:67.5},{x:102.5,y:.5,z:67.5},{x:102,y:.5,z:67.5},{x:101.5,y:.5,z:67.5},{x:101,y:.5,z:67.5},{x:100.5,y:.5,z:67.5},{x:100,y:.5,z:67.5},{x:99.60891383739943,y:.5,z:67.53077914851215},{x:99.22745751406264,y:.5,z:67.62235870926212},{x:98.86502375065113,y:.5,z:67.77248368952908},{x:98.53053686926881,y:.5,z:67.97745751406264},{x:98.23223304703363,y:.5,z:68.23223304703363},{x:97.97745751406264,y:.5,z:68.53053686926881},{x:97.77248368952908,y:.5,z:68.86502375065113},{x:97.62235870926212,y:.5,z:69.22745751406264},{x:97.53077914851215,y:.5,z:69.60891383739943,turn:!0},{x:97.5,y:.5,z:70},{x:97.5,y:.5,z:70.5},{x:97.5,y:.5,z:71},{x:97.5,y:.5,z:71.5},{x:97.5,y:.5,z:72},{x:97.5,y:.5,z:72.5},{x:97.5,y:.5,z:73},{x:97.5,y:.5,z:73.5},{x:97.5,y:.5,z:74},{x:97.5,y:.5,z:74.5},{x:97.5,y:.5,z:75},{x:97.5,y:.5,z:75.5},{x:97.5,y:.5,z:76},{x:97.5,y:.5,z:76.5},{x:97.5,y:.5,z:77},{x:97.5,y:.5,z:77.5},{x:97.5,y:.5,z:78},{x:97.5,y:.5,z:78.5},{x:97.5,y:.5,z:79},{x:97.5,y:.5,z:79.5},{x:97.5,y:.5,z:80},{x:97.5,y:.5,z:80.5},{x:97.5,y:.5,z:81},{x:97.5,y:.5,z:81.5},{x:97.5,y:.5,z:82},{x:97.5,y:.5,z:82.5},{x:97.5,y:.5,z:83},{x:97.5,y:.5,z:83.5},{x:97.5,y:.5,z:84},{x:97.5,y:.5,z:84.5},{x:97.5,y:.5,z:85},{x:97.5,y:.5,z:85.5},{x:97.5,y:.5,z:86},{x:97.5,y:.5,z:86.5},{x:97.5,y:.5,z:87},{x:97.5,y:.5,z:87.5},{x:97.5,y:.5,z:88},{x:97.5,y:.5,z:88.5},{x:97.5,y:.5,z:89},{x:97.5,y:.5,z:89.5},{x:97.5,y:.5,z:90},{x:97.5,y:.5,z:90.5},{x:97.5,y:.5,z:91},{x:97.5,y:.5,z:91.5},{x:97.5,y:.5,z:92},{x:97.5,y:.5,z:92.5},{x:97.5,y:.5,z:93},{x:97.5,y:.5,z:93.5},{x:97.5,y:.5,z:94},{x:97.5,y:.5,z:94.5},{x:97.5,y:.5,z:95},{x:97.5,y:.5,z:95.5},{x:97.5,y:.5,z:96},{x:97.5,y:.5,z:96.5},{x:97.5,y:.5,z:97},{x:97.5,y:.5,z:97.5},{x:97.5,y:.5,z:98},{x:97.5,y:.5,z:98.5},{x:97.5,y:.5,z:99},{x:97.5,y:.5,z:99.5},{x:97.5,y:.5,z:100},{x:97.5,y:.5,z:100.5},{x:97.5,y:.5,z:101},{x:97.5,y:.5,z:101.5},{x:97.5,y:.5,z:102},{x:97.5,y:.5,z:102.5},{x:97.5,y:.5,z:103},{x:97.5,y:.5,z:103.5},{x:97.5,y:.5,z:104},{x:97.5,y:.5,z:104.5},{x:97.5,y:.5,z:105},{x:97.5,y:.5,z:105.5},{x:97.5,y:.5,z:106},{x:97.5,y:.5,z:106.5},{x:97.5,y:.5,z:107},{x:97.5,y:.5,z:107.5},{x:97.5,y:.5,z:108},{x:97.5,y:.5,z:108.5},{x:97.5,y:.5,z:109},{x:97.5,y:.5,z:109.5},{x:97.5,y:.5,z:110},{x:97.53077914851215,y:.5,z:110.39108616260057},{x:97.62235870926212,y:.5,z:110.77254248593736},{x:97.77248368952908,y:.5,z:111.13497624934887},{x:97.97745751406264,y:.5,z:111.46946313073119},{x:98.23223304703363,y:.5,z:111.76776695296637},{x:98.53053686926881,y:.5,z:112.02254248593736},{x:98.86502375065113,y:.5,z:112.22751631047092},{x:99.22745751406264,y:.5,z:112.37764129073788},{x:99.60891383739943,y:.5,z:112.46922085148785,turn:!0},{x:100,y:.5,z:112.5},{x:100.5,y:.5,z:112.5},{x:101,y:.5,z:112.5},{x:101.5,y:.5,z:112.5},{x:102,y:.5,z:112.5},{x:102.5,y:.5,z:112.5},{x:103,y:.5,z:112.5},{x:103.5,y:.5,z:112.5},{x:104,y:.5,z:112.5},{x:104.5,y:.5,z:112.5},{x:105,y:.5,z:112.5},{x:105.5,y:.5,z:112.5},{x:106,y:.5,z:112.5},{x:106.5,y:.5,z:112.5},{x:107,y:.5,z:112.5},{x:107.5,y:.5,z:112.5},{x:108,y:.5,z:112.5},{x:108.5,y:.5,z:112.5},{x:109,y:.5,z:112.5},{x:109.5,y:.5,z:112.5},{x:110,y:.5,z:112.5},{x:110.5,y:.5,z:112.5},{x:111,y:.5,z:112.5},{x:111.5,y:.5,z:112.5},{x:112,y:.5,z:112.5},{x:112.5,y:.5,z:112.5},{x:113,y:.5,z:112.5},{x:113.5,y:.5,z:112.5},{x:114,y:.5,z:112.5},{x:114.5,y:.5,z:112.5},{x:115,y:.5,z:112.5},{x:115.5,y:.5,z:112.5},{x:116,y:.5,z:112.5},{x:116.5,y:.5,z:112.5},{x:117,y:.5,z:112.5},{x:117.5,y:.5,z:112.5},{x:118,y:.5,z:112.5},{x:118.5,y:.5,z:112.5},{x:119,y:.5,z:112.5},{x:119.5,y:.5,z:112.5},{x:120,y:.5,z:112.5},{x:120.5,y:.5,z:112.5},{x:121,y:.5,z:112.5},{x:121.5,y:.5,z:112.5},{x:122,y:.5,z:112.5},{x:122.5,y:.5,z:112.5},{x:123,y:.5,z:112.5},{x:123.5,y:.5,z:112.5},{x:124,y:.5,z:112.5},{x:124.5,y:.5,z:112.5},{x:125,y:.5,z:112.5},{x:125.5,y:.5,z:112.5},{x:126,y:.5,z:112.5},{x:126.5,y:.5,z:112.5},{x:127,y:.5,z:112.5},{x:127.5,y:.5,z:112.5},{x:128,y:.5,z:112.5},{x:128.5,y:.5,z:112.5},{x:129,y:.5,z:112.5},{x:129.5,y:.5,z:112.5},{x:130,y:.5,z:112.5},{x:130.5,y:.5,z:112.5},{x:131,y:.5,z:112.5},{x:131.5,y:.5,z:112.5},{x:132,y:.5,z:112.5},{x:132.5,y:.5,z:112.5},{x:133,y:.5,z:112.5},{x:133.5,y:.5,z:112.5},{x:134,y:.5,z:112.5},{x:134.5,y:.5,z:112.5},{x:135,y:.5,z:112.5},{x:135.5,y:.5,z:112.5},{x:136,y:.5,z:112.5},{x:136.5,y:.5,z:112.5},{x:137,y:.5,z:112.5},{x:137.5,y:.5,z:112.5},{x:138,y:.5,z:112.5},{x:138.5,y:.5,z:112.5},{x:139,y:.5,z:112.5},{x:139.5,y:.5,z:112.5},{x:140,y:.5,z:112.5},{x:140.5,y:.5,z:112.5},{x:141,y:.5,z:112.5},{x:141.5,y:.5,z:112.5},{x:142,y:.5,z:112.5},{x:142.5,y:.5,z:112.5},{x:143,y:.5,z:112.5},{x:143.5,y:.5,z:112.5},{x:144,y:.5,z:112.5},{x:144.5,y:.5,z:112.5},{x:145,y:.5,z:112.5},{x:145.5,y:.5,z:112.5},{x:146,y:.5,z:112.5},{x:146.5,y:.5,z:112.5},{x:147,y:.5,z:112.5},{x:147.5,y:.5,z:112.5},{x:148,y:.5,z:112.5},{x:148.5,y:.5,z:112.5},{x:149,y:.5,z:112.5},{x:149.5,y:.5,z:112.5},{x:150,y:.5,z:112.5},{x:150.5,y:.5,z:112.5},{x:151,y:.5,z:112.5},{x:151.5,y:.5,z:112.5},{x:152,y:.5,z:112.5},{x:152.5,y:.5,z:112.5},{x:153,y:.5,z:112.5},{x:153.5,y:.5,z:112.5},{x:154,y:.5,z:112.5},{x:154.5,y:.5,z:112.5},{x:155,y:.5,z:112.5},{x:155.5,y:.5,z:112.5},{x:156,y:.5,z:112.5},{x:156.5,y:.5,z:112.5},{x:157,y:.5,z:112.5},{x:157.5,y:.5,z:112.5},{x:158,y:.5,z:112.5},{x:158.5,y:.5,z:112.5},{x:159,y:.5,z:112.5},{x:159.5,y:.5,z:112.5},{x:160,y:.5,z:112.5},{x:160.5,y:.5,z:112.5},{x:161,y:.5,z:112.5},{x:161.5,y:.5,z:112.5},{x:162,y:.5,z:112.5},{x:162.5,y:.5,z:112.5},{x:163,y:.5,z:112.5},{x:163.5,y:.5,z:112.5},{x:164,y:.5,z:112.5},{x:164.5,y:.5,z:112.5},{x:165,y:.5,z:112.5},{x:165.5,y:.5,z:112.5},{x:166,y:.5,z:112.5},{x:166.5,y:.5,z:112.5},{x:167,y:.5,z:112.5},{x:167.5,y:.5,z:112.5},{x:168,y:.5,z:112.5},{x:168.5,y:.5,z:112.5},{x:169,y:.5,z:112.5},{x:169.5,y:.5,z:112.5},{x:170,y:.5,z:112.5},{x:170.5,y:.5,z:112.5},{x:171,y:.5,z:112.5},{x:171.5,y:.5,z:112.5},{x:172,y:.5,z:112.5},{x:172.5,y:.5,z:112.5},{x:173,y:.5,z:112.5},{x:173.5,y:.5,z:112.5},{x:174,y:.5,z:112.5},{x:174.5,y:.5,z:112.5},{x:175,y:.5,z:112.5},{x:175.5,y:.5,z:112.5},{x:176,y:.5,z:112.5},{x:176.5,y:.5,z:112.5},{x:177,y:.5,z:112.5},{x:177.5,y:.5,z:112.5},{x:178,y:.5,z:112.5},{x:178.5,y:.5,z:112.5},{x:179,y:.5,z:112.5},{x:179.5,y:.5,z:112.5},{x:180,y:.5,z:112.5},{x:180.5,y:.5,z:112.5},{x:181,y:.5,z:112.5},{x:181.5,y:.5,z:112.5},{x:182,y:.5,z:112.5},{x:182.5,y:.5,z:112.5},{x:183,y:.5,z:112.5},{x:183.5,y:.5,z:112.5},{x:184,y:.5,z:112.5},{x:184.5,y:.5,z:112.5},{x:185,y:.5,z:112.5},{x:185.5,y:.5,z:112.5},{x:186,y:.5,z:112.5},{x:186.5,y:.5,z:112.5},{x:187,y:.5,z:112.5},{x:187.5,y:.5,z:112.5},{x:188,y:.5,z:112.5},{x:188.5,y:.5,z:112.5},{x:189,y:.5,z:112.5},{x:189.5,y:.5,z:112.5},{x:190,y:.5,z:112.5},{x:190.5,y:.5,z:112.5},{x:191,y:.5,z:112.5},{x:191.5,y:.5,z:112.5},{x:192,y:.5,z:112.5},{x:192.5,y:.5,z:112.5},{x:193,y:.5,z:112.5},{x:193.5,y:.5,z:112.5},{x:194,y:.5,z:112.5},{x:194.5,y:.5,z:112.5},{x:195,y:.5,z:112.5},{x:195.5,y:.5,z:112.5},{x:196,y:.5,z:112.5},{x:196.5,y:.5,z:112.5},{x:197,y:.5,z:112.5},{x:197.5,y:.5,z:112.5},{x:198,y:.5,z:112.5},{x:198.5,y:.5,z:112.5},{x:199,y:.5,z:112.5},{x:199.5,y:.5,z:112.5},{x:200,y:.5,z:112.5},{x:200.39108616260057,y:.5,z:112.46922085148785},{x:200.77254248593738,y:.5,z:112.37764129073788},{x:201.13497624934888,y:.5,z:112.22751631047092},{x:201.46946313073119,y:.5,z:112.02254248593736},{x:201.76776695296638,y:.5,z:111.76776695296637},{x:202.02254248593738,y:.5,z:111.46946313073119},{x:202.22751631047092,y:.5,z:111.13497624934887},{x:202.37764129073787,y:.5,z:110.77254248593736},{x:202.46922085148785,y:.5,z:110.39108616260057,turn:!0},{x:202.5,y:.5,z:110},{x:202.46922085148785,y:.5,z:109.60891383739943},{x:202.37764129073787,y:.5,z:109.22745751406264},{x:202.22751631047092,y:.5,z:108.86502375065113},{x:202.02254248593738,y:.5,z:108.53053686926881},{x:201.76776695296638,y:.5,z:108.23223304703363},{x:201.46946313073119,y:.5,z:107.97745751406264},{x:201.13497624934888,y:.5,z:107.77248368952908},{x:200.77254248593738,y:.5,z:107.62235870926212},{x:200.39108616260057,y:.5,z:107.53077914851215,turn:!0},{x:200,y:.5,z:107.5},{x:199.5,y:.5,z:107.5},{x:199,y:.5,z:107.5},{x:198.5,y:.5,z:107.5},{x:198,y:.5,z:107.5},{x:197.5,y:.5,z:107.5},{x:197,y:.5,z:107.5},{x:196.5,y:.5,z:107.5},{x:196,y:.5,z:107.5},{x:195.5,y:.5,z:107.5},{x:195,y:.5,z:107.5},{x:194.5,y:.5,z:107.5},{x:194,y:.5,z:107.5},{x:193.5,y:.5,z:107.5},{x:193,y:.5,z:107.5},{x:192.5,y:.5,z:107.5},{x:192,y:.5,z:107.5},{x:191.5,y:.5,z:107.5},{x:191,y:.5,z:107.5},{x:190.5,y:.5,z:107.5},{x:190,y:.5,z:107.5},{x:189.5,y:.5,z:107.5},{x:189,y:.5,z:107.5},{x:188.5,y:.5,z:107.5},{x:188,y:.5,z:107.5},{x:187.5,y:.5,z:107.5},{x:187,y:.5,z:107.5},{x:186.5,y:.5,z:107.5},{x:186,y:.5,z:107.5},{x:185.5,y:.5,z:107.5},{x:185,y:.5,z:107.5},{x:184.5,y:.5,z:107.5},{x:184,y:.5,z:107.5},{x:183.5,y:.5,z:107.5},{x:183,y:.5,z:107.5},{x:182.5,y:.5,z:107.5},{x:182,y:.5,z:107.5},{x:181.5,y:.5,z:107.5},{x:181,y:.5,z:107.5},{x:180.5,y:.5,z:107.5},{x:180,y:.5,z:107.5},{x:179.5,y:.5,z:107.5},{x:179,y:.5,z:107.5},{x:178.5,y:.5,z:107.5},{x:178,y:.5,z:107.5},{x:177.5,y:.5,z:107.5},{x:177,y:.5,z:107.5},{x:176.5,y:.5,z:107.5},{x:176,y:.5,z:107.5},{x:175.5,y:.5,z:107.5},{x:175,y:.5,z:107.5},{x:174.5,y:.5,z:107.5},{x:174,y:.5,z:107.5},{x:173.5,y:.5,z:107.5},{x:173,y:.5,z:107.5},{x:172.5,y:.5,z:107.5},{x:172,y:.5,z:107.5},{x:171.5,y:.5,z:107.5},{x:171,y:.5,z:107.5},{x:170.5,y:.5,z:107.5},{x:170,y:.5,z:107.5},{x:169.5,y:.5,z:107.5},{x:169,y:.5,z:107.5},{x:168.5,y:.5,z:107.5},{x:168,y:.5,z:107.5},{x:167.5,y:.5,z:107.5},{x:167,y:.5,z:107.5},{x:166.5,y:.5,z:107.5},{x:166,y:.5,z:107.5},{x:165.5,y:.5,z:107.5},{x:165,y:.5,z:107.5},{x:164.5,y:.5,z:107.5},{x:164,y:.5,z:107.5},{x:163.5,y:.5,z:107.5},{x:163,y:.5,z:107.5},{x:162.5,y:.5,z:107.5},{x:162,y:.5,z:107.5},{x:161.5,y:.5,z:107.5},{x:161,y:.5,z:107.5},{x:160.5,y:.5,z:107.5},{x:160,y:.5,z:107.5},{x:159.5,y:.5,z:107.5},{x:159,y:.5,z:107.5},{x:158.5,y:.5,z:107.5},{x:158,y:.5,z:107.5},{x:157.5,y:.5,z:107.5},{x:157,y:.5,z:107.5},{x:156.5,y:.5,z:107.5},{x:156,y:.5,z:107.5},{x:155.5,y:.5,z:107.5},{x:155,y:.5,z:107.5},{x:154.5,y:.5,z:107.5},{x:154,y:.5,z:107.5},{x:153.5,y:.5,z:107.5},{x:153,y:.5,z:107.5},{x:152.5,y:.5,z:107.5},{x:152,y:.5,z:107.5},{x:151.5,y:.5,z:107.5},{x:151,y:.5,z:107.5},{x:150.5,y:.5,z:107.5},{x:150,y:.5,z:107.5},{x:149.60891383739943,y:.5,z:107.53077914851215},{x:149.22745751406262,y:.5,z:107.62235870926212},{x:148.86502375065112,y:.5,z:107.77248368952908},{x:148.53053686926881,y:.5,z:107.97745751406264},{x:148.23223304703365,y:.5,z:108.23223304703363},{x:147.97745751406262,y:.5,z:108.53053686926881},{x:147.77248368952908,y:.5,z:108.86502375065113},{x:147.62235870926213,y:.5,z:109.22745751406264},{x:147.53077914851215,y:.5,z:109.60891383739943,turn:!0},{x:147.5,y:.5,z:110},{x:147.5,y:.5,z:110.5},{x:147.5,y:.5,z:111},{x:147.5,y:.5,z:111.5},{x:147.5,y:.5,z:112},{x:147.5,y:.5,z:112.5},{x:147.5,y:.5,z:113},{x:147.5,y:.5,z:113.5},{x:147.5,y:.5,z:114},{x:147.5,y:.5,z:114.5},{x:147.5,y:.5,z:115},{x:147.5,y:.5,z:115.5},{x:147.5,y:.5,z:116},{x:147.5,y:.5,z:116.5},{x:147.5,y:.5,z:117},{x:147.5,y:.5,z:117.5},{x:147.5,y:.5,z:118},{x:147.5,y:.5,z:118.5},{x:147.5,y:.5,z:119},{x:147.5,y:.5,z:119.5},{x:147.5,y:.5,z:120},{x:147.5,y:.5,z:120.5},{x:147.5,y:.5,z:121},{x:147.5,y:.5,z:121.5},{x:147.5,y:.5,z:122},{x:147.5,y:.5,z:122.5},{x:147.5,y:.5,z:123},{x:147.5,y:.5,z:123.5},{x:147.5,y:.5,z:124},{x:147.5,y:.5,z:124.5},{x:147.5,y:.5,z:125},{x:147.5,y:.5,z:125.5},{x:147.5,y:.5,z:126},{x:147.5,y:.5,z:126.5},{x:147.5,y:.5,z:127},{x:147.5,y:.5,z:127.5},{x:147.5,y:.5,z:128},{x:147.5,y:.5,z:128.5},{x:147.5,y:.5,z:129},{x:147.5,y:.5,z:129.5},{x:147.5,y:.5,z:130},{x:147.5,y:.5,z:130.5},{x:147.5,y:.5,z:131},{x:147.5,y:.5,z:131.5},{x:147.5,y:.5,z:132},{x:147.5,y:.5,z:132.5},{x:147.5,y:.5,z:133},{x:147.5,y:.5,z:133.5},{x:147.5,y:.5,z:134},{x:147.5,y:.5,z:134.5},{x:147.5,y:.5,z:135},{x:147.5,y:.5,z:135.5},{x:147.5,y:.5,z:136},{x:147.5,y:.5,z:136.5},{x:147.5,y:.5,z:137},{x:147.5,y:.5,z:137.5},{x:147.5,y:.5,z:138},{x:147.5,y:.5,z:138.5},{x:147.5,y:.5,z:139},{x:147.5,y:.5,z:139.5},{x:147.5,y:.5,z:140},{x:147.5,y:.5,z:140.5},{x:147.5,y:.5,z:141},{x:147.5,y:.5,z:141.5},{x:147.5,y:.5,z:142},{x:147.5,y:.5,z:142.5},{x:147.5,y:.5,z:143},{x:147.5,y:.5,z:143.5},{x:147.5,y:.5,z:144},{x:147.5,y:.5,z:144.5},{x:147.5,y:.5,z:145},{x:147.5,y:.5,z:145.5},{x:147.5,y:.5,z:146},{x:147.5,y:.5,z:146.5},{x:147.5,y:.5,z:147},{x:147.5,y:.5,z:147.5},{x:147.5,y:.5,z:148},{x:147.5,y:.5,z:148.5},{x:147.5,y:.5,z:149},{x:147.5,y:.5,z:149.5},{x:147.5,y:.5,z:150},{x:147.5,y:.5,z:150.5},{x:147.5,y:.5,z:151},{x:147.5,y:.5,z:151.5},{x:147.5,y:.5,z:152},{x:147.5,y:.5,z:152.5},{x:147.5,y:.5,z:153},{x:147.5,y:.5,z:153.5},{x:147.5,y:.5,z:154},{x:147.5,y:.5,z:154.5},{x:147.5,y:.5,z:155},{x:147.5,y:.5,z:155.5},{x:147.5,y:.5,z:156},{x:147.5,y:.5,z:156.5},{x:147.5,y:.5,z:157},{x:147.5,y:.5,z:157.5},{x:147.5,y:.5,z:158},{x:147.5,y:.5,z:158.5},{x:147.5,y:.5,z:159},{x:147.5,y:.5,z:159.5},{x:147.5,y:.5,z:160},{x:147.5,y:.5,z:160.5},{x:147.5,y:.5,z:161},{x:147.5,y:.5,z:161.5},{x:147.5,y:.5,z:162},{x:147.5,y:.5,z:162.5},{x:147.5,y:.5,z:163},{x:147.5,y:.5,z:163.5},{x:147.5,y:.5,z:164},{x:147.5,y:.5,z:164.5},{x:147.5,y:.5,z:165},{x:147.5,y:.5,z:165.5},{x:147.5,y:.5,z:166},{x:147.5,y:.5,z:166.5},{x:147.5,y:.5,z:167},{x:147.5,y:.5,z:167.5},{x:147.5,y:.5,z:168},{x:147.5,y:.5,z:168.5},{x:147.5,y:.5,z:169},{x:147.5,y:.5,z:169.5},{x:147.5,y:.5,z:170},{x:147.5,y:.5,z:170.5},{x:147.5,y:.5,z:171},{x:147.5,y:.5,z:171.5},{x:147.5,y:.5,z:172},{x:147.5,y:.5,z:172.5},{x:147.5,y:.5,z:173},{x:147.5,y:.5,z:173.5},{x:147.5,y:.5,z:174},{x:147.5,y:.5,z:174.5},{x:147.5,y:.5,z:175},{x:147.5,y:.5,z:175.5},{x:147.5,y:.5,z:176},{x:147.5,y:.5,z:176.5},{x:147.5,y:.5,z:177},{x:147.5,y:.5,z:177.5},{x:147.5,y:.5,z:178},{x:147.5,y:.5,z:178.5},{x:147.5,y:.5,z:179},{x:147.5,y:.5,z:179.5},{x:147.5,y:.5,z:180},{x:147.5,y:.5,z:180.5},{x:147.5,y:.5,z:181},{x:147.5,y:.5,z:181.5},{x:147.5,y:.5,z:182},{x:147.5,y:.5,z:182.5},{x:147.5,y:.5,z:183},{x:147.5,y:.5,z:183.5},{x:147.5,y:.5,z:184},{x:147.5,y:.5,z:184.5},{x:147.5,y:.5,z:185},{x:147.5,y:.5,z:185.5},{x:147.5,y:.5,z:186},{x:147.5,y:.5,z:186.5},{x:147.5,y:.5,z:187},{x:147.5,y:.5,z:187.5},{x:147.5,y:.5,z:188},{x:147.5,y:.5,z:188.5},{x:147.5,y:.5,z:189},{x:147.5,y:.5,z:189.5},{x:147.5,y:.5,z:190},{x:147.5,y:.5,z:190.5},{x:147.5,y:.5,z:191},{x:147.5,y:.5,z:191.5},{x:147.5,y:.5,z:192}],Ar=function(){function t(e){var n=e.directed,r=void 0!==n&&n;Object(Tr.a)(this,t),this.directed=r,this.graphObj={}}return Object(Cr.a)(t,[{key:"addVertex",value:function(t){this.graphObj[t.value]=t}},{key:"addEdge",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this.graphObj[t.value].addEdge(e.value,n),!1===this.directed&&this.graphObj[e.value].addEdge(t.value,n)}}]),t}(),Vr=function(){function t(e,n,r){Object(Tr.a)(this,t),this.value=e,this.x=n,this.z=r,this.edges=[],this.occupied=!1,this.light="green",this.internalCounter=0,this.averageArray=[],this.average=10}return Object(Cr.a)(t,[{key:"getEdges",value:function(){for(var t=[],e=0;e<this.edges.length;e++)t.push(this.edges[e][0]);return t}},{key:"addEdge",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.edges.push([t,e])}},{key:"occupiedCheck",value:function(){!0===this.occupied&&this.internalCounter++}},{key:"occupiedFalse",value:function(){if(this.occupied=!1,this.internalCounter>0&&(this.averageArray.push(this.internalCounter),this.internalCounter=0,this.averageArray.length>10&&this.averageArray.shift(),this.averageArray.length)){var t=this.averageArray.reduce((function(t,e){return t+e}),0);this.average=t/this.averageArray.length}}},{key:"getAverageTime",value:function(){return this.average}}]),t}(),Er=new Ar({directed:!0}),Br=function(t,e,n){var r=Object(l.a)(t[e][n],4),i=r[0],a=r[1],o=r[2],s=r[3],c=_n[e][n],u=t[e][n+1][0],h=t[e][n+1][2],x=t[e+1][n][0],y=t[e+1][n][1];switch(c){case"HR":Er.addEdge(i,a),Er.addEdge(s,o),Gr(a,u,h,s);break;case"VR":Er.addEdge(a,s),Er.addEdge(o,i),Nr(s,y,x,o);break;case"TLC":i.corner="TLCOuter",s.corner="TLCInner",Er.addEdge(i,a),Er.addEdge(o,i),Nr(s,y,x,o),Gr(a,u,h,s);break;case"TRC":a.corner="TRCOuter",o.corner="TRCInner",Er.addEdge(i,a),Er.addEdge(a,s),Nr(s,y,x,o);break;case"BLC":o.corner="BLCOuter",a.corner="BLCInner",Er.addEdge(o,i),Er.addEdge(s,o),Gr(a,u,h,s);break;case"BRC":s.corner="BRCOuter",i.corner="BRCInner",Er.addEdge(a,s),Er.addEdge(s,o);break;case"TT":_r(i,a,o,s),Gr(a,u,h,s);break;case"TB":_r(i,a,o,s),Nr(s,y,x,o),Gr(a,u,h,s);break;case"TL":_r(i,a,o,s),Nr(s,y,x,o);break;case"TR":case"XR":_r(i,a,o,s),Nr(s,y,x,o),Gr(a,u,h,s)}},_r=function(t,e,n,r){Er.addEdge(t,e),Er.addEdge(e,r),Er.addEdge(n,t),Er.addEdge(r,n)},Gr=function(t,e,n,r){Er.addEdge(t,e),Er.addEdge(n,r)},Nr=function(t,e,n,r){Er.addEdge(t,e),Er.addEdge(n,r)},Wr=[],Ur=1,Xr=0;Xr<_n.length;Xr++){Wr.push([]);for(var qr=0;qr<_n[0].length;qr++){if(_n[Xr][qr]){var Zr=[new Vr((wr=Ur)+"A",kr=10*qr,Sr=10*Xr),new Vr(wr+"B",kr+5,Sr),new Vr(wr+"C",kr,Sr+5),new Vr(wr+"D",kr+5,Sr+5)];Zr.forEach((function(t){return Er.addVertex(t)})),Wr[Xr].push(Zr),Ur++}else Wr[Xr].push(0)}}for(var Hr=0;Hr<_n.length;Hr++)for(var Yr=0;Yr<_n[0].length;Yr++)Wr[Hr][Yr]&&Br(Wr,Hr,Yr);Er.lookup=Wr;var Jr=2.5,Qr=function(){function t(){var e=this;Object(Tr.a)(this,t),this.destinationReached=function(){return{forces:{steering:0,engine:0,braking:25},gauges:{steering:0,accel:0}}},this.getForces=function(){var t=0,n=0;e.obstacleCheck(),e.obstacles={};var r=e.angleDiff*e.steerVal;return!1!==e.slowDown&&e.velocity>e.slowDown?n=e.maxBrakeForce*Rr.b(e.velocity/e.maxSpeed):!1!==e.slowDown&&e.velocity<e.slowDown?e.slowDown=!1:t=-e.maxForce*Rr.c(Math.max(e.maxSpeed-e.velocity,0)/e.maxSpeed),e.reverseObstacle?(e.velocity>e.prevVel&&(r=-r),e.prevVel=e.velocity,t=300):e.reverse&&Math.abs(e.angleDiff)<Math.PI/3?e.reverse=!1:(e.reverse||Math.abs(e.angleDiff)>Math.PI/2)&&(e.reverse=!0,r=-r/2,t=-t),[r,t,n]},this.map=Er.graphObj,this.verticesLookup=Er.lookup,this.stepCount=10,this.arrayOfSteps=Fr.slice(),this.target=new In.Vector2,this.velocityVector=new In.Vector3,this.position=new In.Vector2,this.followCamVector=new In.Vector3,this.chassisVector=new In.Vector3,this.slowDown=0,this.reverse=!1,this.steerVal=.875,this.maxForce=1e3,this.maxBrakeForce=20,this.maxSpeed=18,this.stoppingDistance=35,this.slowDistance=20,this.obstacles={},this.pathDistanceCheck=2,this.maxAngle=2*Math.PI/8,this.anglesToCheck=this.getAnglesToCheck(0),this.prevVel=0}return Object(Cr.a)(t,[{key:"run",value:function(){if(this.position){if(!this.getNextTarget())return this.destinationReached();var t=this.target.sub(this.position).angle();this.angleDiff=t-this.rotation,this.angleDiff>Math.PI?this.angleDiff-=2*Math.PI:this.angleDiff<-Math.PI&&(this.angleDiff+=2*Math.PI),this.pathGeometry&&this.pathGeometry.setVertices(this.arrayOfSteps);var e=this.approachingEnd()?3:!!this.approachingTurn()&&8;e&&this.velocity>e?this.slowDown=e:this.slowDown=!1;var n=this.getForces(),r=Object(l.a)(n,3),i=r[0],a=r[1],o=r[2];return{forces:{steering:i,engine:a,braking:o},gauges:this.getGuagevals(i,a,o)}}}},{key:"approachingEnd",value:function(){return!this.arrayOfSteps[this.stoppingDistance]}},{key:"approachingTurn",value:function(){var t=this.arrayOfSteps[this.arrayOfSteps.length-1],e=this.arrayOfSteps[this.arrayOfSteps.length-this.slowDistance];return!(!t||!e)&&(t.x!==e.x&&t.z!==e.z)}},{key:"getNextTarget",value:function(){for(;;){if(!this.arrayOfSteps.length)return;var t=this.arrayOfSteps[this.arrayOfSteps.length-1],e=t.x,n=t.z;if(this.target.set(e,-n),!(this.position.distanceTo(this.target)<this.pathDistanceCheck))return!0;this.arrayOfSteps.pop(),this.pathDistanceCheck=2}}},{key:"obstacleCheck",value:function(){var t=Object.keys(this.obstacles);if(t.length){var e=this.distanceToClosestObstacle(t);if(!this.checkEmergency())if(e<2.5||this.reverseObstacle&&e<6)this.reverseObstacle=!0;else if(e!==1/0){this.reverseObstacle=!1,this.pathDistanceCheck=10;var n=this.findAngleSpaceRequired(e);e+=1;var r=!1;this.anglesToCheck=this.getAnglesToCheck(this.angleDiff);var i,a=Object(Pr.a)(this.anglesToCheck);try{for(a.s();!(i=a.n()).done;){var o=i.value;if(this.angleDiff=o,!1===this.checkIfAngleIsObstructed(t,n,e)){r=!0;break}}}catch(s){a.e(s)}finally{a.f()}r?this.velocity>10&&(this.slowDown=10):(e<6&&(this.steering=0,this.reverseObstacle=!0),this.slowDown=0)}else this.reverseObstacle=!1}}},{key:"distanceToClosestObstacle",value:function(t){var e=this;return this.leftSide=this.leftBumper=this.rightBumper=this.rightSide=!1,t.reduce((function(t,n){var r=Object(l.a)(e.obstacles[n],2),i=r[0],a=r[1];return a&&i<3&&(n>Math.PI/6?e.leftSide=!0:n>0?e.leftBumper=!0:n>-Math.PI/6?e.rightBumper=!0:e.rightSide=!0),(a||!a&&i<6)&&Math.abs(e.angleDiff-n)<.15&&i<t?i:t}),1/0)}},{key:"checkIfAngleIsObstructed",value:function(t,e,n){for(var r=0;r<t.length;r++){var i=t[r],a=Object(l.a)(this.obstacles[i],2),o=a[0],s=a[1];if((s||!(o>n))&&(!(s&&o>n+4)&&Math.abs(this.angleDiff-i)<e))return!0}return!1}},{key:"findAngleSpaceRequired",value:function(t){return Math.asin(1.6/t)}},{key:"getAnglesToCheck",value:function(t){for(var e=[],n=Math.PI/67.5,r=t-Math.PI/10;r>=-Math.PI/3;r-=n)e.push(r);for(var i=t-Math.PI/10+n;i<=Math.PI/3;i+=n)e.push(i);return e}},{key:"checkEmergency",value:function(){return(this.leftBumper||this.rightBumper)&&(this.reverseObstacle=!0),this.leftBumper&&this.rightBumper?(this.angleDiff=0,!0):this.leftBumper?(this.angleDiff=-.75,!0):this.rightBumper?(this.angleDiff=.75,!0):this.leftSide||this.rightSide?(this.angleDiff=0,!0):void 0}},{key:"getGuagevals",value:function(t,e,n){return{steering:function(t){return t?t<-1?1:t>1?-1:-t:0}(t),accel:function(t,e){return e?-e/25:-t/1500}(e,n)}}},{key:"clearPath",value:function(){this.arrayOfSteps=[],this.pathGeometry.setVertices(this.arrayOfSteps)}},{key:"click",value:function(t){var e=this.findVertex(this.position.x,-this.position.y),n=this.findVertex(t.x,t.z);e&&n&&e!==n&&(this.runPathfinding(e,n),this.pathGeometry.setVertices(this.arrayOfSteps),this.slowDown=!1)}},{key:"findVertex",value:function(t,e){var n=(t-5)/10,r=(e-5)/10,i=Math.ceil(r),a=Math.ceil(n),o=this.verticesLookup[i][a];if(o){var s=n%1,c=r%1;switch(!0){case s<=.5&&c<=.5:return o[0].value;case s>.5&&c<=.5:return o[1].value;case s<=.5&&c>.5:return o[2].value;case s>.5&&c>.5:return o[3].value}}}},{key:"runPathfinding",value:function(t,e){var n=Ir(this.map,t,e);this.arrayOfSteps=this.buildPath(n.path)}},{key:"buildPath",value:function(t){return this.pathParameters={arrayOfSteps:[],currentX:0,currentZ:0},this.buildFirstSegment(t),this.buildMiddleSegments(t),this.buildLastSegment(t),this.pathParameters.arrayOfSteps.reverse()}},{key:"buildFirstSegment",value:function(t){var e=this.map[t[0]],n=this.map[t[1]];this.pathParameters.currentX=e.x,this.pathParameters.currentZ=e.z,this.straight(e,n,this.stepCount/2)}},{key:"buildMiddleSegments",value:function(t){for(var e=1;e<t.length-1;e++){var n=this.map[t[e-1]],r=this.map[t[e]],i=this.map[t[e+1]];n.x!==i.x&&n.z!==i.z?this.turn(n,i):this.straight(r,i,this.stepCount)}}},{key:"buildLastSegment",value:function(t){var e=this.map[t[t.length-1]],n=this.map[t[t.length-2]];this.straight(n,e,this.stepCount/2)}},{key:"turn",value:function(t,e){for(var n=(t.x+e.x)/2,r=(t.z+e.z)/2,i=this.pathParameters.currentX===n?e.x:n,a=this.pathParameters.currentZ===r?e.z:r,o=Dr(n,r,this.pathParameters.currentX,this.pathParameters.currentZ,i,a),s=1;s<o.length;s++){var c=o[s],l={x:c.x-Jr,y:.5,z:-c.y-Jr};1===s&&(l.turn=!0),this.pathParameters.arrayOfSteps.push(l);var u=o[o.length-1];this.pathParameters.currentX=u.x,this.pathParameters.currentZ=-u.y}}},{key:"straight",value:function(t,e,n){for(var r=(e.x-t.x)/this.stepCount,i=(e.z-t.z)/this.stepCount,a=0;a<n;a++){this.pathParameters.currentX+=r,this.pathParameters.currentZ+=i;var o={x:this.pathParameters.currentX-Jr,y:.5,z:this.pathParameters.currentZ-Jr};this.pathParameters.arrayOfSteps.push(o)}}},{key:"updateDNA",value:function(t){this.steerVal=t.steerVal,this.maxForce=t.maxForce,this.maxBrakeForce=t.maxBrakeForce,this.maxSpeed=t.maxSpeed,this.stoppingDistance=t.stoppingDistance,this.slowDistance=t.slowDistance,this.arrayOfSteps=Fr.slice()}}]),t}(),Kr={weights:[{values:[-1.772324562072754,1.7685779333114624,-.2709619104862213,4.713095188140869,.6939423084259033,5.132308483123779,-5.232407569885254,-1.9752379655838013,-2.746316909790039,-7.2349138259887695,-2.069463014602661,-1.9897977113723755,-1.955976963043213,1.2858145236968994,.704613447189331,6.658992290496826,5.875704765319824,.9332337975502014,-3.514477491378784,.6144475936889648,-3.567613124847412,.139107346534729,2.725809097290039,-3.415637731552124,-2.9787163734436035,-2.570011854171753,-.13293768465518951,1.9560809135437012,-1.1485075950622559,2.3664610385894775,-4.621173858642578,8.636507987976074,-5.994246006011963,7.800809383392334,-5.942988395690918,1.3981736898422241,.4659249484539032,4.838597297668457,-.48707327246665955,-1.2003954648971558],shape:[4,10]},{values:[-2.3900017738342285,5.807179927825928,-2.911468982696533,5.386925220489502,5.308575630187988,-1.4375249147415161,-.9528937339782715,-4.528890132904053,-5.752671241760254,-.26759231090545654],shape:[10]},{values:[5.692469120025635,-9.47739028930664,-.03620252385735512,3.2833492755889893,.008293052203953266,2.261491298675537,1.170644998550415,4.369087219238281,4.550158500671387,7.136785984039307,4.1197428703308105,-10.550789833068848,-5.731776714324951,.8240111470222473,.7344014644622803,-1.3899316787719727,1.7062362432479858,3.855755567550659,-5.40840482711792,.4775134027004242],shape:[10,2]},{values:[.23723840713500977,-2.6100058555603027],shape:[2]}],nodes:[4,10,2]},$r=n(149);$r.c("cpu");var ti=function(){function t(e,n,r,i){Object(Tr.a)(this,t),this.input=e,this.hidden=n,this.output=r,this.createModel(i)}return Object(Cr.a)(t,[{key:"createModel",value:function(t){this.model=$r.b();var e=$r.a.dense({inputShape:[this.input],units:this.hidden,activation:"sigmoid"});this.model.add(e);var n=$r.a.dense({units:this.output,activation:"sigmoid"});this.model.add(n),t&&this.model.setWeights(t)}},{key:"predict",value:function(t){var e=this;return $r.f((function(){var n=$r.e([t]);return e.model.predict(n).dataSync()}))}},{key:"dispose",value:function(){this.model.dispose()}}],[{key:"loadJSON",value:function(e){var n=e.weights,r=e.nodes,i=n.map((function(t){var e=t.values,n=t.shape;return $r.d(e,n)}));return new t(r[0],r[1],r[2],i)}}]),t}(),ei=2.5,ni=function(){function t(){Object(Tr.a)(this,t),this.stepCount=10,this.map=Er.graphObj,this.verticesLookup=Er.lookup,this.arrayOfSteps=Fr.slice(),this.target=new In.Vector2,this.velocityVector=new In.Vector3,this.position=new In.Vector2,this.followCamVector=new In.Vector3,this.chassisVector=new In.Vector3,this.distanceToTurn=0,this.outputs=null,this.pathDistanceCheck=2,this.brain=ti.loadJSON(Kr),this.obstacles={}}return Object(Cr.a)(t,[{key:"run",value:function(){if(this.position)return this.getNextTarget()?(this.getAngleDiff(),this.pathGeometry&&this.pathGeometry.setVertices(this.arrayOfSteps),this.reverse||Math.abs(this.angleDiff)>Math.PI/2?this.reverseSteering():this.AISteering()):this.destinationReached()}},{key:"getAngleDiff",value:function(){var t=this.target.sub(this.position).angle();this.angleDiff=t-this.rotation,this.angleDiff>Math.PI?this.angleDiff-=2*Math.PI:this.angleDiff<-Math.PI&&(this.angleDiff+=2*Math.PI)}},{key:"getNextTarget",value:function(){for(;;){if(!this.arrayOfSteps.length)return;this.distanceToTurn<=0&&this.getDistanceToTurn();var t=this.arrayOfSteps[this.arrayOfSteps.length-1],e=t.x,n=t.z;if(this.target.set(e,-n),!(this.position.distanceTo(this.target)<this.pathDistanceCheck))return!0;this.distanceToTurn--,this.arrayOfSteps.pop()}}},{key:"getDistanceToTurn",value:function(){var t=this.arrayOfSteps[this.arrayOfSteps.length-1];if(t){for(var e=0,n=this.arrayOfSteps.length-1;n>=this.arrayOfSteps.length-50;n--){e++;var r=this.arrayOfSteps[n];if(!r)break;if(t.x!==r.x&&t.z!==r.z)return void(this.distanceToTurn=e)}this.distanceToTurn=Math.min(this.arrayOfSteps.length,50)}else this.distanceToTurn=0}},{key:"convertOutputs",value:function(t){var e=Object(l.a)(t,2),n=e[0],r=e[1];return{steering:2*(n-.5),engine:r>.5?-3e3*(r-.5):0,braking:r<.5?100*(.5-r):0}}},{key:"destinationReached",value:function(){return{forces:{steering:0,engine:0,braking:25},gauges:{steering:0,accel:0}}}},{key:"AISteering",value:function(){var t=Math.min(this.arrayOfSteps.length,50);this.inputs=[this.angleDiff/Math.PI,this.velocity/30,1-t/50,1-this.distanceToTurn/50],this.outputs=this.brain.predict(this.inputs);var e=this.convertOutputs(this.outputs),n=e.steering,r=e.engine,i=e.braking;return{forces:{steering:n,engine:r,braking:i},gauges:this.getGuagevals(n,r,i)}}},{key:"reverseSteering",value:function(){Math.abs(this.angleDiff)<Math.PI/3?this.reverse=!1:this.reverse=!0;var t=-.5*Math.sign(this.angleDiff);return{forces:{steering:t,engine:750,braking:0},gauges:this.getGuagevals(t,750,0)}}},{key:"getGuagevals",value:function(t,e,n){return{steering:function(t){return t?t<-1?1:t>1?-1:-t:0}(t),accel:function(t,e){return e?-e/25:-t/1500}(e,n)}}},{key:"clearPath",value:function(){this.arrayOfSteps=[],this.pathGeometry.setVertices(this.arrayOfSteps)}},{key:"click",value:function(t){var e=this.findVertex(this.position.x,-this.position.y),n=this.findVertex(t.x,t.z);e&&n&&e!==n&&(this.runPathfinding(e,n),this.pathGeometry.setVertices(this.arrayOfSteps),this.slowDown=!1)}},{key:"findVertex",value:function(t,e){var n=(t-5)/10,r=(e-5)/10,i=Math.ceil(r),a=Math.ceil(n),o=this.verticesLookup[i][a];if(o){var s=n%1,c=r%1;switch(!0){case s<=.5&&c<=.5:return o[0].value;case s>.5&&c<=.5:return o[1].value;case s<=.5&&c>.5:return o[2].value;case s>.5&&c>.5:return o[3].value}}}},{key:"runPathfinding",value:function(t,e){var n=Ir(this.map,t,e);this.arrayOfSteps=this.buildPath(n.path)}},{key:"buildPath",value:function(t){return this.pathParameters={arrayOfSteps:[],currentX:0,currentZ:0},this.buildFirstSegment(t),this.buildMiddleSegments(t),this.buildLastSegment(t),this.pathParameters.arrayOfSteps.reverse()}},{key:"buildFirstSegment",value:function(t){var e=this.map[t[0]],n=this.map[t[1]];this.pathParameters.currentX=e.x,this.pathParameters.currentZ=e.z,this.straight(e,n,this.stepCount/2)}},{key:"buildMiddleSegments",value:function(t){for(var e=1;e<t.length-1;e++){var n=this.map[t[e-1]],r=this.map[t[e]],i=this.map[t[e+1]];n.x!==i.x&&n.z!==i.z?this.turn(n,i):this.straight(r,i,this.stepCount)}}},{key:"buildLastSegment",value:function(t){var e=this.map[t[t.length-1]],n=this.map[t[t.length-2]];this.straight(n,e,this.stepCount/2)}},{key:"turn",value:function(t,e){for(var n=(t.x+e.x)/2,r=(t.z+e.z)/2,i=this.pathParameters.currentX===n?e.x:n,a=this.pathParameters.currentZ===r?e.z:r,o=Dr(n,r,this.pathParameters.currentX,this.pathParameters.currentZ,i,a),s=1;s<o.length;s++){var c=o[s],l={x:c.x-ei,y:.5,z:-c.y-ei};1===s&&(l.turn=!0),this.pathParameters.arrayOfSteps.push(l);var u=o[o.length-1];this.pathParameters.currentX=u.x,this.pathParameters.currentZ=-u.y}}},{key:"straight",value:function(t,e,n){for(var r=(e.x-t.x)/this.stepCount,i=(e.z-t.z)/this.stepCount,a=0;a<n;a++){this.pathParameters.currentX+=r,this.pathParameters.currentZ+=i;var o={x:this.pathParameters.currentX-ei,y:.5,z:this.pathParameters.currentZ-ei};this.pathParameters.arrayOfSteps.push(o)}}}]),t}(),ri=function(){function t(){var e=this;Object(Tr.a)(this,t),this.destinationReached=function(){return{forces:{steering:0,engine:0,braking:25},gauges:{steering:0,accel:0}}},this.getForces=function(t){var n=0,r=0,i=t*e.steerVal;return e.slowDown&&e.velocity>e.slowDown?r=e.maxBrakeForce*Rr.b(e.velocity/e.maxSpeed):e.slowDown&&e.velocity<e.slowDown?e.slowDown=!1:n=-e.maxForce*Rr.c(Math.max(e.maxSpeed-e.velocity,0)/e.maxSpeed),e.reverse&&Math.abs(t)<Math.PI/3?e.reverse=!1:(e.reverse||Math.abs(t)>Math.PI/2)&&(e.reverse=!0,i=-i/2,n=-n),[i,n,r]},this.arrayOfSteps=Fr.slice(),this.target=new In.Vector2,this.velocityVector=new In.Vector3,this.position=new In.Vector2,this.slowDown=0,this.reverse=!1,this.steerVal=.875,this.maxForce=1e3,this.maxBrakeForce=20,this.maxSpeed=18,this.stoppingDistance=35,this.slowDistance=20}return Object(Cr.a)(t,[{key:"run",value:function(){if(this.position){if(!this.getNextTarget())return this.destinationReached();var t=this.target.sub(this.position).angle()-this.rotation;t>Math.PI?t-=2*Math.PI:t<-Math.PI&&(t+=2*Math.PI);var e=this.approachingEnd()?3:!!this.approachingTurn()&&8;e&&this.velocity>e&&(this.slowDown=e);var n=this.getForces(t),r=Object(l.a)(n,3);return{forces:{steering:r[0],engine:r[1],braking:r[2]}}}}},{key:"approachingEnd",value:function(){return!this.arrayOfSteps[this.stoppingDistance]}},{key:"approachingTurn",value:function(){var t;return null===(t=this.arrayOfSteps[this.arrayOfSteps.length-this.slowDistance])||void 0===t?void 0:t.turn}},{key:"getNextTarget",value:function(){for(;;){if(!this.arrayOfSteps.length)return;var t=this.arrayOfSteps[this.arrayOfSteps.length-1],e=t.x,n=t.z;if(this.target.set(e,-n),!(this.position.distanceTo(this.target)<2))return!0;this.arrayOfSteps.pop()}}},{key:"updateDNA",value:function(t){this.steerVal=t.steerVal,this.maxForce=t.maxForce,this.maxBrakeForce=t.maxBrakeForce,this.maxSpeed=t.maxSpeed,this.stoppingDistance=t.stoppingDistance,this.slowDistance=t.slowDistance,this.arrayOfSteps=Fr.slice()}}]),t}(),ii=function(t){var e=t.rotation,n=t.position,r=t.angularVelocity,i=t.ghostRef,a=[1.7,1,4],o=Object(Tn.b)((function(){return{mass:500,position:n,rotation:e,angularVelocity:r,args:a,collisionFilterGroup:2,collisionFilterMask:1}}),i),s=Object(l.a)(o,2)[1];return Object(b.jsxs)("mesh",{ref:i,api:s,children:[Object(b.jsx)("boxBufferGeometry",{attach:"geometry",args:[1.7,1,4]}),Object(b.jsx)("meshLambertMaterial",{transparent:!0,opacity:.5,color:"grey",attach:"material"})]})},ai=Object(i.forwardRef)((function(t,e){t.props;return Object(Tn.c)((function(){return{mass:1,type:"Kinematic",collisionFilterGroup:0}}),e),Object(b.jsx)(b.Fragment,{})}));function oi(t){var e=t.ghostRef,n=t.vehicleRef,r=t.position,i=t.rotation,a=t.angularVelocity,o=hr(),s=Object(l.a)(o,2),c=s[0],u=s[1],h=Object(Tn.e)((function(){return{chassisBody:e,wheels:c,wheelInfos:u,indexForwardAxis:2,indexRightAxis:0,indexUpAxis:1}}),n),x=Object(l.a)(h,2)[1];return Object(b.jsxs)("group",{ref:n,api:x,children:[Object(b.jsx)(ii,{ghostRef:e,rotation:i,position:r,angularVelocity:a}),Object(b.jsx)(ai,{ref:c[0]}),Object(b.jsx)(ai,{ref:c[1]}),Object(b.jsx)(ai,{ref:c[2]}),Object(b.jsx)(ai,{ref:c[3]})]})}var si=function(t,e,n,r){var a=Object(i.useState)(!1),o=Object(l.a)(a,2),s=o[0],c=o[1];!function(t,e){Object(kn.f)((function(){var n;if(null===(n=e.current)||void 0===n?void 0:n.api){var r=t.run();if(r){var i=r.forces,a=i.steering,o=i.engine,s=i.braking;e.current.api.applyEngineForce(o,2),e.current.api.applyEngineForce(o,3),e.current.api.setSteeringValue(a,0),e.current.api.setSteeringValue(a,1);for(var c=0;c<4;c++)e.current.api.setBrake(s,c)}}}))}(n,e),Object(i.useEffect)((function(){r&&(n.updateDNA(r),c([!1]))}),[n,r]),Object(i.useEffect)((function(){s&&(t.current.api.position.set(147.5,4,192.5),t.current.api.angularVelocity.set(0,0,0),t.current.api.velocity.set(0,0,0),t.current.api.rotation.set(0,Math.PI,0))}),[s,t])};function ci(t){var e=t.ghostDNA,n=Object(i.useMemo)((function(){return new ri}),[]),r=Object(i.useRef)(),a=Object(i.useRef)();return function(t,e){Object(i.useEffect)((function(){var n=e.current,r=n.api.position.subscribe((function(e){t&&t.position.set(e[0],-e[2])})),i=n.api.velocity.subscribe((function(e){var n;t&&((n=t.velocityVector).set.apply(n,Object(Dn.a)(e)),t.velocity=t.velocityVector.length())})),a=n.api.rotation.subscribe((function(e){t&&(t.rotation=e[1]-Math.PI/2)}));return function(){r(),i(),a()}}),[])}(n,r),si(r,a,n,e),Object(b.jsx)(oi,{ghostRef:r,vehicleRef:a,position:[147.5,4,192.5],angularVelocity:[0,0,0],rotation:[0,Math.PI,0]})}var li=n(509),ui=n(504),hi=n(393),xi=n(211),yi=n(385),di=n(394),bi=n(386);function gi(t){var e=t.strength,n=Object(i.useRef)(),r=Object(kn.h)(),o=r.scene,s=r.gl,c=r.size,u=r.camera,h=a.a.useState((function(){return new In.Vector2(512,512)})),x=Object(l.a)(h,1)[0];Object(i.useEffect)((function(){n.current.setSize(c.width,c.height)}),[c]),Object(kn.f)((function(){return n.current.render()}),1);var y={resolution:x,radius:1,threshold:.01};return Object(b.jsxs)("effectComposer",{ref:n,args:[s],children:[Object(b.jsx)("renderPass",{attachArray:"passes",scene:o,camera:u}),Object(b.jsx)("unrealBloomPass",{attachArray:"passes",args:[y.resolution,e,y.radius,y.threshold]},e),Object(b.jsx)("shaderPass",{attachArray:"passes",args:[bi.a],"material-uniforms-resolution-value":[1/c.width,1/c.height],renderToScreen:!0})]})}Object(kn.d)({EffectComposer:hi.a,ShaderPass:xi.a,RenderPass:yi.a,UnrealBloomPass:di.a});var fi={night:{directionalLight:.25,ambientLight:.3,inclination:.48,bloom:1,rayleigh:5,sunPosition:750},sunset:{directionalLight:1.7,ambientLight:.3,inclination:.491,bloom:.4,rayleigh:.9,sunPosition:750},day:{directionalLight:1,ambientLight:1.5,inclination:.61,bloom:0,rayleigh:.07,sunPosition:1e3}};function ji(t){var e=t.time,n=t.quality,r=Object(i.useState)(fi[e]),a=Object(l.a)(r,2),o=a[0],s=a[1],c=Object(i.useState)(!1),u=Object(l.a)(c,2),h=u[0],x=u[1],y=Object(i.useRef)(e),d=Object(i.useRef)(!1),g=Object(i.useRef)(0);return Object(i.useEffect)((function(){y.current!==e&&(x("night"===e),d.current=!0,g.current=0)}),[e]),Object(kn.f)((function(){if(d.current){g.current++;var t={};Object.keys(o).forEach((function(n){t[n]=function(t,e,n){return(1-n)*t+n*e}(fi[y.current][n],fi[e][n],g.current/100)})),s(t),g.current>99&&(d.current=!1,y.current=e)}})),Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)("ambientLight",{color:"#ffffff",intensity:o.ambientLight+(1===n?.7:0)}),n>1&&Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)("directionalLight",{color:"#ffffff",intensity:o.directionalLight,position:[0,o.sunPosition,-1e3]}),Object(b.jsx)(li.a,{distance:45e3,inclination:o.inclination,azimuth:.25,rayleigh:o.rayleigh}),h&&Object(b.jsx)(ui.a,{radius:1e3,factor:15})]}),n>2&&Object(b.jsx)(gi,{strength:o.bloom})]})}var pi=n.p+"static/media/cone.c60637f7.glb";function zi(t){var e=Object(Jn.a)(pi),n=e.nodes,r=e.materials;return Object(b.jsx)("group",Object(m.a)(Object(m.a)({},t),{},{dispose:null,children:Object(b.jsx)("group",{rotation:[-Math.PI/2,0,0],children:Object(b.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:n.Mesh_0.geometry,material:r.cono})})}))}function mi(t){var e=t.obstacle,n=Object(Tn.c)((function(){return{mass:1e3,position:[e.x,3,e.z],args:[.75,.75,1],collisionFilterGroup:1,collisionFilterMask:3,userData:{id:"obstacle"}}})),r=Object(l.a)(n,1)[0];return Object(b.jsx)("mesh",{ref:r,frustumCulled:!1,children:Object(b.jsx)(zi,{position:[0,-.5,0],scale:.5})})}function Oi(t){var e=t.wall;return Object(Tn.b)((function(){return{mass:1e3,position:[e.x,0,e.z],args:[e.w,10,e.h],collisionFilterGroup:4,type:"Static",userData:{id:"wall"}}})),Object(b.jsx)(b.Fragment,{})}Jn.a.preload(pi);var vi=[{h:50,w:130,x:80,z:40},{h:50,w:120,x:215,z:40},{h:80,w:30,x:30,z:105},{h:80,w:30,x:30,z:195},{h:80,w:40,x:255,z:195},{h:80,w:40,x:255,z:105},{h:40,w:120,x:215,z:255},{h:40,w:130,x:80,z:255},{h:30,w:40,x:75,z:90},{h:30,w:40,x:75,z:130},{h:30,w:40,x:75,z:170},{h:30,w:40,x:125,z:170},{h:30,w:40,x:175,z:170},{h:30,w:40,x:125,z:130},{h:30,w:40,x:175,z:130},{h:30,w:40,x:205,z:210},{h:30,w:40,x:155,z:210},{h:30,w:70,x:90,z:210},{h:30,w:90,x:150,z:90},{h:30,w:20,x:215,z:90},{h:30,w:20,x:215,z:130},{h:30,w:20,x:215,z:170}];function wi(t){var e=t.obstacles;return Object(b.jsx)(b.Fragment,{children:e.length>0&&Object(b.jsxs)(b.Fragment,{children:[e.map((function(t){return Object(b.jsx)(mi,{obstacle:t},t.id)})),vi.map((function(t,e){return Object(b.jsx)(Oi,{wall:t},e)}))]})})}var ki,Si=Object(C.b)({name:"gauges",initialState:{gauges:null},reducers:{setgauges:function(t,e){t.gauges=e.payload}}}),Pi=Si.actions.setgauges,Ti=Si.reducer,Ci=Object(i.memo)((function(){var t=Object(o.b)(),e=Object(i.useState)(null),n=Object(l.a)(e,2),r=n[0],a=n[1],s=(Object(o.c)((function(t){return t.settings.trafficLights})),Object(o.c)((function(t){return t.settings.cameraLock}))),c=Object(o.c)((function(t){return t.mode.mode})),u=Object(o.c)((function(t){return t.training.currentDNA})),h=Object(o.c)((function(t){return t.training.ghosts})),x=Object(o.c)((function(t){return t.settings.time})),y=Object(o.c)((function(t){return t.settings.addObstacles})),d=Object(o.c)((function(t){return t.settings.obstacles})),g=Object(o.c)((function(t){return t.settings.AICar})),f=Object(o.c)((function(t){return t.settings.helpOpen})),j=Object(o.c)((function(t){return t.quality.quality})),p=Object(i.useMemo)((function(){return g?new ni:new Qr}),[g]),z=Rn.a.throttle((function(e){t(Pi(e))}),200);return Object(b.jsxs)(fr,{cursorTarget:y,children:[Object(b.jsx)(kn.a,{colorManagement:!1,camera:{far:4e3},frameloop:"on demand",children:Object(b.jsxs)(Tn.a,{gravity:[0,-10,0],broadphase:"SAP",allowSleep:!0,shouldInvalidate:!1,children:[Object(b.jsx)(Sn.a,{className:"stats"}),Object(b.jsx)(En,{cameraLock:s,player:p,isPaused:f}),Object(b.jsxs)(i.Suspense,{fallback:null,children:[Object(b.jsx)(Un,{addObstacles:y,setSelectedVertex:a,onNewObstacle:function(e){t(V(e))}}),Object(b.jsx)(wi,{obstacles:d}),Object(b.jsx)(gr,{player:p,selectedVertex:r,mode:c,currentDNA:u,setGauges:z,time:x,obstacles:d,useAICar:g,quality:j}),h.map((function(t,e){return Object(b.jsx)(ci,{ghostDNA:t},e)}))]}),Object(b.jsx)(ji,{time:x,quality:j})]})}),Object(b.jsx)(Pn.a,{})]})})),Ri=n(284),Mi=n.n(Ri),Ii=y.b.div(ki||(ki=Object(x.a)(["\n  position: absolute;\n  bottom: 0;\n  width: 100%;\n  display: flex;\n  justify-content: center;\n  margin-bottom: 30px;\n  pointer-events: none;\n"])));function Di(){var t=Object(o.c)((function(t){return t.gauges.gauges})),e=Object(o.c)((function(t){return t.quality.quality}));return Object(b.jsx)(b.Fragment,{children:e>1&&Object(b.jsxs)(Ii,{children:[Object(b.jsx)(Mi.a,{value:null===t||void 0===t?void 0:t.accel,minValue:-1,maxValue:1,height:185,needleTransitionDuration:200,segments:100,maxSegmentLabels:0,ringWidth:10,currentValueText:"Acceleration",needleTransition:"easeLinear",needleColor:"#90f2ff",needleHeightRatio:.8,textColor:"#d8dee9"}),Object(b.jsx)(Mi.a,{value:null===t||void 0===t?void 0:t.steering,minValue:-1,maxValue:1,height:185,needleTransitionDuration:200,segments:100,maxSegmentLabels:0,ringWidth:10,currentValueText:"Steering",needleTransition:"easeLinear",needleColor:"#90f2ff",needleHeightRatio:.8,textColor:"#d8dee9"})]})})}function Li(){return Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)(wn,{}),Object(b.jsx)(Ci,{}),Object(b.jsx)(Di,{})]})}var Fi,Ai,Vi=n(390),Ei=n.n(Vi),Bi=n(391),_i=n.n(Bi),Gi=y.b.div(Fi||(Fi=Object(x.a)(["\n  width: 100vw;\n  height: 100vh;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n"]))),Ni=y.b.div(Ai||(Ai=Object(x.a)(["\n  font-size: 1.5rem;\n  margin: 20px;\n"])));function Wi(t){var e=t.warning,n=t.setOrientationCheck;return Object(b.jsxs)(Gi,{children:["orientation"===e?Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)(Ei.a,{fontSize:"large"}),Object(b.jsx)(Ni,{children:"Please rotate your device"})]}):Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)(_i.a,{fontSize:"large"}),Object(b.jsx)(Ni,{children:"This app is not suitable for small devices"})]}),Object(b.jsx)(v.a,{onClick:function(){n(!1)},color:"primary",variant:"contained",children:"Ignore"})]})}var Ui,Xi,qi,Zi,Hi;function Yi(t){var e=t.children,n=function(){var t=Object(i.useState)(!1),e=Object(l.a)(t,2),n=e[0],r=e[1];return Object(i.useEffect)((function(){var t=function(){window.innerWidth<1e3?r("size"):window.innerHeight>window.innerWidth?r("orientation"):r(!1)};return t(),window.addEventListener("resize",t),function(){window.removeEventListener("resize",t)}}),[]),[n,r]}(),r=Object(l.a)(n,2),a=r[0],o=r[1];return Object(b.jsx)(b.Fragment,{children:a?Object(b.jsx)(Wi,{warning:a,setOrientationCheck:o}):Object(b.jsx)(b.Fragment,{children:e})})}var Ji=y.b.div(Ui||(Ui=Object(x.a)(["\n  height: 100vh;\n  width: 100vw;\n  background-color: rgb(10, 2, 29);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n"]))),Qi=y.b.div(Xi||(Xi=Object(x.a)(["\n  background-color: rgb(236, 236, 236);\n  height: 150;\n  width: 350px;\n  border-radius: 25px;\n  padding: 16px;\n  box-sizing: border-box;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  box-shadow: rgba(255, 255, 255, 0.575) 0px 5px 15px;\n"]))),Ki=y.b.div(qi||(qi=Object(x.a)(["\n  font-size: 1.6rem;\n  font-weight: 500;\n"]))),$i=y.b.div(Zi||(Zi=Object(x.a)(["\n  display: flex;\n  margin-top: 15px;\n"]))),ta=y.b.div(Hi||(Hi=Object(x.a)(["\n  background-color: royalblue;\n  margin: 10px;\n  padding: 15px;\n  border-radius: 10px;\n  width: 70px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: white;\n  cursor: pointer;\n  box-shadow: rgba(0, 0, 0, 0.35) 0px 5px 15px;\n"])));function ea(){var t=Object(o.b)(),e=function(e){t(pn(e))};return Object(b.jsx)(Ji,{children:Object(b.jsxs)(Qi,{children:[Object(b.jsx)(Ki,{children:"Select Quality"}),Object(b.jsxs)($i,{children:[Object(b.jsx)(ta,{onClick:function(){return e(1)},children:"Low"}),Object(b.jsx)(ta,{onClick:function(){return e(2)},children:"Medium"}),Object(b.jsx)(ta,{onClick:function(){return e(3)},children:"High"})]})]})})}function na(t){var e=t.children,n=Object(o.c)((function(t){return t.quality.quality}));return Object(b.jsx)(b.Fragment,{children:n?Object(b.jsx)(b.Fragment,{children:e}):Object(b.jsx)(ea,{})})}var ra,ia=n(507),aa=n(505),oa=n(506),sa=n(392),ca=Object(y.a)(ra||(ra=Object(x.a)(['\n\nbody {\n  margin: 0;\n  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Oxygen",\n    "Ubuntu", "Cantarell", "Fira Sans", "Droid Sans", "Helvetica Neue",\n    sans-serif;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n  overflow: hidden;\n}\n\ncode {\n  font-family: source-code-pro, Menlo, Monaco, Consolas, "Courier New",\n    monospace;\n}\n.stats{\n  position:absolute;\n  top: unset !important;\n  left: unset !important;\n  right:0;\n  bottom:0;\n}\n\n'])));function la(t){var e=t.children,n=Object(sa.a)({palette:{primary:{main:"rgb(25,120,216)"}},overrides:{MuiDrawer:{paper:{background:"linear-gradient(to right bottom, rgba(255, 255, 255, 0.5), rgba(255, 255, 255, 0.2))",backdropFilter:"blur(1rem)",backgroundColor:"transparent"},paperAnchorDockedLeft:{borderRight:"none"}},MuiBackdrop:{root:{backgroundColor:"rgba(0, 0, 0, 0.2)"}},MuiPaper:{rounded:{borderRadius:0}},MuiDialog:{paperWidthFalse:{maxHeight:"100%",maxWidth:"100%"},paper:{background:"rgba(255,255,255,0.9)",margin:"0"}}}});return Object(b.jsx)(ia.b,{injectFirst:!0,children:Object(b.jsxs)(aa.a,{theme:n,children:[Object(b.jsx)(ca,{}),Object(b.jsx)(oa.a,{}),e]})})}var ua=Object(C.b)({name:"roadWorks",initialState:{addRoadWorks:!1,removeRoadWorks:!1},reducers:{toggleAddRoadWorks:function(t){t.addRoadWorks=!t.addRoadWorks,t.addRoadWorks&&(t.removeRoadWorks=!1)},toggleRemoveRoadWorks:function(t){t.removeRoadWorks=!t.removeRoadWorks,t.removeRoadWorks&&(t.addRoadWorks=!1)}}}),ha=ua.actions,xa=(ha.toggleAddRoadWorks,ha.toggleRemoveRoadWorks,ua.reducer),ya=Object(C.a)({reducer:{roadWorks:xa,settings:N,mode:Kt,training:ae,quality:zn,gauges:Ti}});c.a.render(Object(b.jsx)(o.a,{store:ya,children:Object(b.jsx)(la,{children:Object(b.jsx)(Yi,{children:Object(b.jsx)(na,{children:Object(b.jsx)(Li,{})})})})}),document.getElementById("root"))}},[[460,14,15]]]);
//# sourceMappingURL=main.25f11f48.chunk.js.map